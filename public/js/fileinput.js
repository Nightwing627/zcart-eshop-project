!function(e){"use strict";"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&void 0!==module.exports?module.exports=e():window.KvSortable=e()}(function(){"use strict";function e(t,i){if(!t||!t.nodeType||1!==t.nodeType)throw"KvSortable: `el` must be HTMLElement, and not "+{}.toString.call(t);this.el=t,this.options=i=m({},i),t[Z]=this;var n={group:Math.random(),sort:!0,disabled:!1,store:null,handle:null,scroll:!0,scrollSensitivity:30,scrollSpeed:10,draggable:/[uo]l/i.test(t.nodeName)?"li":">*",ghostClass:"kvsortable-ghost",chosenClass:"kvsortable-chosen",dragClass:"kvsortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,setData:function(e,t){e.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,forceFallback:!1,fallbackClass:"kvsortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:!1!==e.supportPointer};for(var r in n)!(r in i)&&(i[r]=n[r]);re(i);for(var o in this)"_"===o.charAt(0)&&"function"==typeof this[o]&&(this[o]=this[o].bind(this));this.nativeDraggable=!i.forceFallback&&G,a(t,"mousedown",this._onTapStart),a(t,"touchstart",this._onTapStart),i.supportPointer&&a(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(a(t,"dragover",this),a(t,"dragenter",this)),ae.push(this._onDragOver),i.store&&this.sort(i.store.get(this))}function t(e,t){"clone"!==e.lastPullMode&&(t=!0),y&&y.state!==t&&(o(y,"display",t?"none":""),t||y.state&&(e.options.group.revertClone?(x.insertBefore(y,T),e._animate(_,y)):x.insertBefore(y,_)),y.state=t)}function i(e,t,i){if(e){i=i||H;do{if(">*"===t&&e.parentNode===i||f(e,t))return e}while(e=function(e){var t=e.host;return t&&t.nodeType?t:e.parentNode}(e))}return null}function a(e,t,i){e.addEventListener(t,i,X)}function n(e,t,i){e.removeEventListener(t,i,X)}function r(e,t,i){if(e)if(e.classList)e.classList[i?"add":"remove"](t);else{var a=(" "+e.className+" ").replace(L," ").replace(" "+t+" "," ");e.className=(a+(i?" "+t:"")).replace(L," ")}}function o(e,t,i){var a=e&&e.style;if(a){if(void 0===i)return H.defaultView&&H.defaultView.getComputedStyle?i=H.defaultView.getComputedStyle(e,""):e.currentStyle&&(i=e.currentStyle),void 0===t?i:i[t];t in a||(t="-webkit-"+t),a[t]=i+("string"==typeof i?"":"px")}}function l(e,t,i){if(e){var a=e.getElementsByTagName(t),n=0,r=a.length;if(i)for(;n<r;n++)i(a[n],n);return a}return[]}function s(e,t,i,a,n,r,o,l){e=e||t[Z];var s=H.createEvent("Event"),d=e.options,c="on"+i.charAt(0).toUpperCase()+i.substr(1);s.initEvent(i,!0,!0),s.to=n||t,s.from=r||t,s.item=a||t,s.clone=y,s.oldIndex=o,s.newIndex=l,t.dispatchEvent(s),d[c]&&d[c].call(e,s)}function d(e,t,i,a,n,r,o,l){var s,d,c=e[Z],u=c.options.onMove;return(s=H.createEvent("Event")).initEvent("move",!0,!0),s.to=t,s.from=e,s.dragged=i,s.draggedRect=a,s.related=n||t,s.relatedRect=r||t.getBoundingClientRect(),s.willInsertAfter=l,e.dispatchEvent(s),u&&(d=u.call(c,s,o)),d}function c(e){e.draggable=!1}function u(){J=!1}function p(e,t){var i=0;if(!e||!e.parentNode)return-1;for(;e&&(e=e.previousElementSibling);)"TEMPLATE"===e.nodeName.toUpperCase()||">*"!==t&&!f(e,t)||i++;return i}function f(e,t){if(e){var i=(t=t.split(".")).shift().toUpperCase(),a=new RegExp("\\s("+t.join("|")+")(?=\\s)","g");return!(""!==i&&e.nodeName.toUpperCase()!=i||t.length&&((" "+e.className+" ").match(a)||[]).length!=t.length)}return!1}function h(e,t){var i,a;return function(){void 0===i&&(i=arguments,a=this,V(function(){1===i.length?e.call(a,i[0]):e.apply(a,i),i=void 0},t))}}function m(e,t){if(e&&t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function v(e){return Y&&Y.dom?Y.dom(e).cloneNode(!0):q?q(e).clone(!0)[0]:e.cloneNode(!0)}function g(e){return V(e,0)}function w(e){return clearTimeout(e)}if("undefined"==typeof window||!window.document)return function(){throw new Error("KvSortable.js requires a window with a document")};var _,b,C,y,x,T,E,S,k,F,P,D,I,A,z,$,j,U,B,O,R={},L=/\s+/g,M=/left|right|inline/,Z="KvSortable"+(new Date).getTime(),N=window,H=N.document,W=N.parseInt,V=N.setTimeout,q=N.jQuery||N.Zepto,Y=N.Polymer,X=!1,K=!1,G="draggable"in H.createElement("div"),Q=function(e){return!navigator.userAgent.match(/(?:Trident.*rv[ :]?11\.|msie)/i)&&(e=H.createElement("x"),e.style.cssText="pointer-events:auto","auto"===e.style.pointerEvents)}(),J=!1,ee=Math.abs,te=Math.min,ie=[],ae=[],ne=h(function(e,t,i){if(i&&t.scroll){var a,n,r,o,l,s,d=i[Z],c=t.scrollSensitivity,u=t.scrollSpeed,p=e.clientX,f=e.clientY,h=window.innerWidth,m=window.innerHeight;if(k!==i&&(S=t.scroll,k=i,F=t.scrollFn,!0===S)){S=i;do{if(S.offsetWidth<S.scrollWidth||S.offsetHeight<S.scrollHeight)break}while(S=S.parentNode)}S&&(a=S,n=S.getBoundingClientRect(),r=(ee(n.right-p)<=c)-(ee(n.left-p)<=c),o=(ee(n.bottom-f)<=c)-(ee(n.top-f)<=c)),r||o||(o=(m-f<=c)-(f<=c),((r=(h-p<=c)-(p<=c))||o)&&(a=N)),R.vx===r&&R.vy===o&&R.el===a||(R.el=a,R.vx=r,R.vy=o,clearInterval(R.pid),a&&(R.pid=setInterval(function(){if(s=o?o*u:0,l=r?r*u:0,"function"==typeof F)return F.call(d,l,s,e);a===N?N.scrollTo(N.pageXOffset+l,N.pageYOffset+s):(a.scrollTop+=s,a.scrollLeft+=l)},24)))}},30),re=function(e){function t(e,t){return void 0!==e&&!0!==e||(e=i.name),"function"==typeof e?e:function(i,a){var n=a.options.group.name;return t?e:e&&(e.join?e.indexOf(n)>-1:n==e)}}var i={},a=e.group;a&&"object"==typeof a||(a={name:a}),i.name=a.name,i.checkPull=t(a.pull,!0),i.checkPut=t(a.put),i.revertClone=a.revertClone,e.group=i};try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){X={capture:!1,passive:K=!1}}}))}catch(e){}return e.prototype={constructor:e,_onTapStart:function(e){var t,a=this,n=this.el,r=this.options,o=r.preventOnFilter,l=e.type,d=e.touches&&e.touches[0],c=(d||e).target,u=e.target.shadowRoot&&e.path&&e.path[0]||c,f=r.filter;if(function(e){for(var t=e.getElementsByTagName("input"),i=t.length;i--;){var a=t[i];a.checked&&ie.push(a)}}(n),!_&&!(/mousedown|pointerdown/.test(l)&&0!==e.button||r.disabled)&&!u.isContentEditable&&(c=i(c,r.draggable,n))&&E!==c){if(t=p(c,r.draggable),"function"==typeof f){if(f.call(this,e,c,this))return s(a,u,"filter",c,n,n,t),void(o&&e.preventDefault())}else if(f&&(f=f.split(",").some(function(e){if(e=i(u,e.trim(),n))return s(a,e,"filter",c,n,n,t),!0})))return void(o&&e.preventDefault());r.handle&&!i(u,r.handle,n)||this._prepareDragStart(e,d,c,t)}},_prepareDragStart:function(e,t,i,n){var o,d=this,u=d.el,p=d.options,f=u.ownerDocument;i&&!_&&i.parentNode===u&&(U=e,x=u,b=(_=i).parentNode,T=_.nextSibling,E=i,$=p.group,A=n,this._lastX=(t||e).clientX,this._lastY=(t||e).clientY,_.style["will-change"]="all",o=function(){d._disableDelayedDrag(),_.draggable=d.nativeDraggable,r(_,p.chosenClass,!0),d._triggerDragStart(e,t),s(d,x,"choose",_,x,x,A)},p.ignore.split(",").forEach(function(e){l(_,e.trim(),c)}),a(f,"mouseup",d._onDrop),a(f,"touchend",d._onDrop),a(f,"touchcancel",d._onDrop),a(f,"selectstart",d),p.supportPointer&&a(f,"pointercancel",d._onDrop),p.delay?(a(f,"mouseup",d._disableDelayedDrag),a(f,"touchend",d._disableDelayedDrag),a(f,"touchcancel",d._disableDelayedDrag),a(f,"mousemove",d._disableDelayedDrag),a(f,"touchmove",d._disableDelayedDrag),p.supportPointer&&a(f,"pointermove",d._disableDelayedDrag),d._dragStartTimer=V(o,p.delay)):o())},_disableDelayedDrag:function(){var e=this.el.ownerDocument;clearTimeout(this._dragStartTimer),n(e,"mouseup",this._disableDelayedDrag),n(e,"touchend",this._disableDelayedDrag),n(e,"touchcancel",this._disableDelayedDrag),n(e,"mousemove",this._disableDelayedDrag),n(e,"touchmove",this._disableDelayedDrag),n(e,"pointermove",this._disableDelayedDrag)},_triggerDragStart:function(e,t){(t=t||("touch"==e.pointerType?e:null))?(U={target:_,clientX:t.clientX,clientY:t.clientY},this._onDragStart(U,"touch")):this.nativeDraggable?(a(_,"dragend",this),a(x,"dragstart",this._onDragStart)):this._onDragStart(U,!0);try{H.selection?g(function(){H.selection.empty()}):window.getSelection().removeAllRanges()}catch(e){}},_dragStarted:function(){if(x&&_){var t=this.options;r(_,t.ghostClass,!0),r(_,t.dragClass,!1),e.active=this,s(this,x,"start",_,x,x,A)}else this._nulling()},_emulateDragOver:function(){if(B){if(this._lastX===B.clientX&&this._lastY===B.clientY)return;this._lastX=B.clientX,this._lastY=B.clientY,Q||o(C,"display","none");var e=H.elementFromPoint(B.clientX,B.clientY),t=e,i=ae.length;if(e&&e.shadowRoot&&(t=e=e.shadowRoot.elementFromPoint(B.clientX,B.clientY)),t)do{if(t[Z]){for(;i--;)ae[i]({clientX:B.clientX,clientY:B.clientY,target:e,rootEl:t});break}e=t}while(t=t.parentNode);Q||o(C,"display","")}},_onTouchMove:function(t){if(U){var i=this.options,a=i.fallbackTolerance,n=i.fallbackOffset,r=t.touches?t.touches[0]:t,l=r.clientX-U.clientX+n.x,s=r.clientY-U.clientY+n.y,d=t.touches?"translate3d("+l+"px,"+s+"px,0)":"translate("+l+"px,"+s+"px)";if(!e.active){if(a&&te(ee(r.clientX-this._lastX),ee(r.clientY-this._lastY))<a)return;this._dragStarted()}this._appendGhost(),O=!0,B=r,o(C,"webkitTransform",d),o(C,"mozTransform",d),o(C,"msTransform",d),o(C,"transform",d),t.preventDefault()}},_appendGhost:function(){if(!C){var e,t=_.getBoundingClientRect(),i=o(_),a=this.options;r(C=_.cloneNode(!0),a.ghostClass,!1),r(C,a.fallbackClass,!0),r(C,a.dragClass,!0),o(C,"top",t.top-W(i.marginTop,10)),o(C,"left",t.left-W(i.marginLeft,10)),o(C,"width",t.width),o(C,"height",t.height),o(C,"opacity","0.8"),o(C,"position","fixed"),o(C,"zIndex","100000"),o(C,"pointerEvents","none"),a.fallbackOnBody&&H.body.appendChild(C)||x.appendChild(C),e=C.getBoundingClientRect(),o(C,"width",2*t.width-e.width),o(C,"height",2*t.height-e.height)}},_onDragStart:function(e,t){var i=this,n=e.dataTransfer,l=i.options;i._offUpEvents(),$.checkPull(i,i,_,e)&&((y=v(_)).draggable=!1,y.style["will-change"]="",o(y,"display","none"),r(y,i.options.chosenClass,!1),i._cloneId=g(function(){x.insertBefore(y,_),s(i,x,"clone",_)})),r(_,l.dragClass,!0),t?("touch"===t?(a(H,"touchmove",i._onTouchMove),a(H,"touchend",i._onDrop),a(H,"touchcancel",i._onDrop),l.supportPointer&&(a(H,"pointermove",i._onTouchMove),a(H,"pointerup",i._onDrop))):(a(H,"mousemove",i._onTouchMove),a(H,"mouseup",i._onDrop)),i._loopId=setInterval(i._emulateDragOver,50)):(n&&(n.effectAllowed="move",l.setData&&l.setData.call(i,n,_)),a(H,"drop",i),i._dragStartId=g(i._dragStarted))},_onDragOver:function(a){var n,r,l,s,c=this.el,p=this.options,f=p.group,h=e.active,m=$===f,v=!1,g=p.sort;if(void 0!==a.preventDefault&&(a.preventDefault(),!p.dragoverBubble&&a.stopPropagation()),!_.animated&&(O=!0,h&&!p.disabled&&(m?g||(s=!x.contains(_)):j===this||(h.lastPullMode=$.checkPull(this,h,_,a))&&f.checkPut(this,h,_,a))&&(void 0===a.rootEl||a.rootEl===this.el))){if(ne(a,p,this.el),J)return;if(n=i(a.target,p.draggable,c),r=_.getBoundingClientRect(),j!==this&&(j=this,v=!0),s)return t(h,!0),b=x,void(y||T?x.insertBefore(_,y||T):g||x.appendChild(_));if(0===c.children.length||c.children[0]===C||c===a.target&&function(e,t){var i=e.lastElementChild.getBoundingClientRect();return t.clientY-(i.top+i.height)>5||t.clientX-(i.left+i.width)>5}(c,a)){if(0!==c.children.length&&c.children[0]!==C&&c===a.target&&(n=c.lastElementChild),n){if(n.animated)return;l=n.getBoundingClientRect()}t(h,m),!1!==d(x,c,_,r,n,l,a)&&(_.contains(c)||(c.appendChild(_),b=c),this._animate(r,_),n&&this._animate(l,n))}else if(n&&!n.animated&&n!==_&&void 0!==n.parentNode[Z]){P!==n&&(P=n,D=o(n),I=o(n.parentNode));var w=(l=n.getBoundingClientRect()).right-l.left,E=l.bottom-l.top,S=M.test(D.cssFloat+D.display)||"flex"==I.display&&0===I["flex-direction"].indexOf("row"),k=n.offsetWidth>_.offsetWidth,F=n.offsetHeight>_.offsetHeight,A=(S?(a.clientX-l.left)/w:(a.clientY-l.top)/E)>.5,z=n.nextElementSibling,U=!1;if(S){var B=_.offsetTop,R=n.offsetTop;U=B===R?n.previousElementSibling===_&&!k||A&&k:n.previousElementSibling===_||_.previousElementSibling===n?(a.clientY-l.top)/E>.5:R>B}else v||(U=z!==_&&!F||A&&F);var L=d(x,c,_,r,n,l,a,U);!1!==L&&(1!==L&&-1!==L||(U=1===L),J=!0,V(u,30),t(h,m),_.contains(c)||(U&&!z?c.appendChild(_):n.parentNode.insertBefore(_,U?z:n)),b=_.parentNode,this._animate(r,_),this._animate(l,n))}}},_animate:function(e,t){var i=this.options.animation;if(i){var a=t.getBoundingClientRect();1===e.nodeType&&(e=e.getBoundingClientRect()),o(t,"transition","none"),o(t,"transform","translate3d("+(e.left-a.left)+"px,"+(e.top-a.top)+"px,0)"),t.offsetWidth,o(t,"transition","all "+i+"ms"),o(t,"transform","translate3d(0,0,0)"),clearTimeout(t.animated),t.animated=V(function(){o(t,"transition",""),o(t,"transform",""),t.animated=!1},i)}},_offUpEvents:function(){var e=this.el.ownerDocument;n(H,"touchmove",this._onTouchMove),n(H,"pointermove",this._onTouchMove),n(e,"mouseup",this._onDrop),n(e,"touchend",this._onDrop),n(e,"pointerup",this._onDrop),n(e,"touchcancel",this._onDrop),n(e,"pointercancel",this._onDrop),n(e,"selectstart",this)},_onDrop:function(t){var i=this.el,a=this.options;clearInterval(this._loopId),clearInterval(R.pid),clearTimeout(this._dragStartTimer),w(this._cloneId),w(this._dragStartId),n(H,"mouseover",this),n(H,"mousemove",this._onTouchMove),this.nativeDraggable&&(n(H,"drop",this),n(i,"dragstart",this._onDragStart)),this._offUpEvents(),t&&(O&&(t.preventDefault(),!a.dropBubble&&t.stopPropagation()),C&&C.parentNode&&C.parentNode.removeChild(C),x!==b&&"clone"===e.active.lastPullMode||y&&y.parentNode&&y.parentNode.removeChild(y),_&&(this.nativeDraggable&&n(_,"dragend",this),c(_),_.style["will-change"]="",r(_,this.options.ghostClass,!1),r(_,this.options.chosenClass,!1),s(this,x,"unchoose",_,b,x,A),x!==b?(z=p(_,a.draggable))>=0&&(s(null,b,"add",_,b,x,A,z),s(this,x,"remove",_,b,x,A,z),s(null,b,"sort",_,b,x,A,z),s(this,x,"sort",_,b,x,A,z)):_.nextSibling!==T&&(z=p(_,a.draggable))>=0&&(s(this,x,"update",_,b,x,A,z),s(this,x,"sort",_,b,x,A,z)),e.active&&(null!=z&&-1!==z||(z=A),s(this,x,"end",_,b,x,A,z),this.save()))),this._nulling()},_nulling:function(){x=_=b=C=T=y=E=S=k=U=B=O=z=P=D=j=$=e.active=null,ie.forEach(function(e){e.checked=!0}),ie.length=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragover":case"dragenter":_&&(this._onDragOver(e),function(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.preventDefault()}(e));break;case"mouseover":this._onDrop(e);break;case"selectstart":e.preventDefault()}},toArray:function(){for(var e,t=[],a=this.el.children,n=0,r=a.length,o=this.options;n<r;n++)i(e=a[n],o.draggable,this.el)&&t.push(e.getAttribute(o.dataIdAttr)||function(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,i=t.length,a=0;i--;)a+=t.charCodeAt(i);return a.toString(36)}(e));return t},sort:function(e){var t={},a=this.el;this.toArray().forEach(function(e,n){var r=a.children[n];i(r,this.options.draggable,a)&&(t[e]=r)},this),e.forEach(function(e){t[e]&&(a.removeChild(t[e]),a.appendChild(t[e]))})},save:function(){var e=this.options.store;e&&e.set(this)},closest:function(e,t){return i(e,t||this.options.draggable,this.el)},option:function(e,t){var i=this.options;if(void 0===t)return i[e];i[e]=t,"group"===e&&re(i)},destroy:function(){var e=this.el;e[Z]=null,n(e,"mousedown",this._onTapStart),n(e,"touchstart",this._onTapStart),n(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(n(e,"dragover",this),n(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(e){e.removeAttribute("draggable")}),ae.splice(ae.indexOf(this._onDragOver),1),this._onDrop(),this.el=e=null}},a(H,"touchmove",function(t){e.active&&t.preventDefault()}),e.utils={on:a,off:n,css:o,find:l,is:function(e,t){return!!i(e,t,e)},extend:m,throttle:h,closest:i,toggleClass:r,clone:v,index:p,nextTick:g,cancelNextTick:w},e.create=function(t,i){return new e(t,i)},e.version="1.7.0",e}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){"use strict";e.fn.kvsortable=function(t){var i,a=arguments;return this.each(function(){var n=e(this),r=n.data("kvsortable");r||!(t instanceof Object)&&t||(r=new KvSortable(this,t),n.data("kvsortable",r)),r&&("widget"===t?i=r:"destroy"===t?(r.destroy(),n.removeData("kvsortable")):"function"==typeof r[t]?i=r[t].apply(r,[].slice.call(a,1)):t in r.options&&(i=r.option.apply(r,a)))}),void 0===i?this:i}}),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(window.jQuery)}(function(e){"use strict";e.fn.fileinputLocales={},e.fn.fileinputThemes={},String.prototype.setTokens=function(e){var t,i,a=this.toString();for(t in e)e.hasOwnProperty(t)&&(i=new RegExp("{"+t+"}","g"),a=a.replace(i,e[t]));return a};var t,i;t={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}</span>\n</div>',MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],objUrl:window.URL||window.webkitURL,compare:function(e,t,i){return void 0!==e&&(i?e===t:e.match(t))},isIE:function(e){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===e)return new RegExp("msie\\s"+e,"i").test(navigator.userAgent);var t,i=document.createElement("div");return i.innerHTML="\x3c!--[if IE "+e+"]> <i></i> <![endif]--\x3e",t=i.getElementsByTagName("i").length,document.body.appendChild(i),i.parentNode.removeChild(i),t},initModal:function(t){var i=e("body");i.length&&t.appendTo(i)},isEmpty:function(t,i){return void 0===t||null===t||0===t.length||i&&""===e.trim(t)},isArray:function(e){return Array.isArray(e)||"[object Array]"===Object.prototype.toString.call(e)},ifSet:function(e,t,i){return i=i||"",t&&"object"==typeof t&&e in t?t[e]:i},cleanArray:function(e){return e instanceof Array||(e=[]),e.filter(function(e){return void 0!==e&&null!==e})},spliceArray:function(t,i,a){var n,r,o=0,l=[];if(!(t instanceof Array))return[];for(r=e.extend(!0,[],t),a&&r.reverse(),n=0;n<r.length;n++)n!==i&&(l[o]=r[n],o++);return a&&l.reverse(),l},getNum:function(e,t){return t=t||0,"number"==typeof e?e:("string"==typeof e&&(e=parseFloat(e)),isNaN(e)?t:e)},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var e=document.createElement("div");return!t.isIE(9)&&(void 0!==e.draggable||void 0!==e.ondragstart&&void 0!==e.ondrop)},hasFileUploadSupport:function(){return t.hasFileAPISupport()&&window.FormData},hasBlobSupport:function(){try{return!!window.Blob&&Boolean(new Blob)}catch(e){return!1}},hasArrayBufferViewSupport:function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}},dataURI2Blob:function(e){var i,a,n,r,o,l,s=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,d=t.hasBlobSupport();if(!((d||s)&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return null;for(i=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),a=new ArrayBuffer(i.length),n=new Uint8Array(a),r=0;r<i.length;r+=1)n[r]=i.charCodeAt(r);return o=e.split(",")[0].split(":")[1].split(";")[0],d?new Blob([t.hasArrayBufferViewSupport()?n:a],{type:o}):(l=new s,l.append(a),l.getBlob(o))},arrayBuffer2String:function(e){if(window.TextDecoder)return new TextDecoder("utf-8").decode(e);var t,i,a,n,r=Array.prototype.slice.apply(new Uint8Array(e)),o="",l=0;for(t=r.length;t>l;)switch((i=r[l++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(i);break;case 12:case 13:a=r[l++],o+=String.fromCharCode((31&i)<<6|63&a);break;case 14:a=r[l++],n=r[l++],o+=String.fromCharCode((15&i)<<12|(63&a)<<6|(63&n)<<0)}return o},isHtml:function(e){var t=document.createElement("div");t.innerHTML=e;for(var i=t.childNodes,a=i.length;a--;)if(1===i[a].nodeType)return!0;return!1},isSvg:function(e){return e.match(/^\s*<\?xml/i)&&(e.match(/<!DOCTYPE svg/i)||e.match(/<svg/i))},getMimeType:function(e,t,i){switch(e){case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":return"image/jpeg";case"89504E47":return"image/png";case"47494638":return"image/gif";case"49492a00":return"image/tiff";case"52494646":return"image/webp";case"66747970":return"video/3gp";case"4f676753":return"video/ogg";case"1a45dfa3":return"video/mkv";case"000001ba":case"000001b3":return"video/mpeg";case"3026b275":return"video/wmv";case"25504446":return"application/pdf";case"25215053":return"application/ps";case"504b0304":case"504b0506":case"504b0508":return"application/zip";case"377abcaf":return"application/7z";case"75737461":return"application/tar";case"7801730d":return"application/dmg";default:switch(e.substring(0,6)){case"435753":return"application/x-shockwave-flash";case"494433":return"audio/mp3";case"425a68":return"application/bzip";default:switch(e.substring(0,4)){case"424d":return"image/bmp";case"fffb":return"audio/mp3";case"4d5a":return"application/exe";case"1f9d":case"1fa0":return"application/zip";case"1f8b":return"application/gzip";default:return t&&!t.match(/[^\u0000-\u007f]/)?"application/text-plain":i}}}},addCss:function(e,t){e.removeClass(t).addClass(t)},getElement:function(i,a,n){return t.isEmpty(i)||t.isEmpty(i[a])?n:e(i[a])},uniqId:function(){return Math.round((new Date).getTime())+"_"+Math.round(100*Math.random())},htmlEncode:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(t,i){var a=t;return i?(e.each(i,function(e,t){"function"==typeof t&&(t=t()),a=a.split(e).join(t)}),a):a},cleanMemory:function(e){var i=e.is("img")?e.attr("src"):e.find("source").attr("src");t.objUrl.revokeObjectURL(i)},findFileName:function(e){var t=e.lastIndexOf("/");return-1===t&&(t=e.lastIndexOf("\\")),e.split(e.substring(t,t+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(e){var i=document,a=i.documentElement;a&&e&&!t.checkFullScreen()?a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):i.exitFullscreen?i.exitFullscreen():i.msExitFullscreen?i.msExitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()},moveArray:function(t,i,a,n){var r=e.extend(!0,[],t);if(n&&r.reverse(),a>=r.length)for(var o=a-r.length;1+o--;)r.push(void 0);return r.splice(a,0,r.splice(i,1)[0]),n&&r.reverse(),r},cleanZoomCache:function(e){var t=e.closest(".kv-zoom-cache-theme");t.length||(t=e.closest(".kv-zoom-cache")),t.remove()},setOrientation:function(e,t){var i,a,n,r=new DataView(e),o=0,l=1;if(65496!==r.getUint16(o)||e.length<2)return void(t&&t());for(o+=2,i=r.byteLength;i-2>o;)switch(a=r.getUint16(o),o+=2,a){case 65505:n=r.getUint16(o),i=n-o,o+=2;break;case 274:l=r.getUint16(o+6,!1),i=0}t&&t(l)},validateOrientation:function(e,i){if(window.FileReader&&window.DataView){var a,n=new FileReader;n.onloadend=function(){a=n.result,t.setOrientation(a,i)},n.readAsArrayBuffer(e)}},adjustOrientedImage:function(e,t){var i,a,n;if(e.hasClass("is-portrait-gt4")){if(t)return void e.css({width:e.parent().height()});e.css({height:"auto",width:e.height()}),i=e.parent().offset().top,a=e.offset().top,n=i-a,e.css("margin-top",n)}},closeButton:function(e){return'<button type="button" class="'+(e=e?"close "+e:"close")+'" aria-label="Close">\n  <span aria-hidden="true">&times;</span>\n</button>'}},i=function(i,a){var n=this;n.$element=e(i),n.$parent=n.$element.parent(),n._validate()&&(n.isPreviewable=t.hasFileAPISupport(),n.isIE9=t.isIE(9),n.isIE10=t.isIE(10),(n.isPreviewable||n.isIE9)&&(n._init(a),n._listen()),n.$element.removeClass("file-loading"))},i.prototype={constructor:i,_cleanup:function(){var e=this;e.reader=null,e.formdata={},e.uploadCount=0,e.uploadStatus={},e.uploadLog=[],e.uploadAsyncCount=0,e.loadedImages=[],e.totalImagesCount=0,e.ajaxRequests=[],e.clearStack(),e.fileInputCleared=!1,e.fileBatchCompleted=!0,e.isPreviewable||(e.showPreview=!1),e.isError=!1,e.ajaxAborted=!1,e.cancelling=!1},_init:function(i,a){var n,r,o,l,s=this,d=s.$element;s.options=i,e.each(i,function(e,i){switch(e){case"minFileCount":case"maxFileCount":case"minFileSize":case"maxFileSize":case"maxFilePreviewSize":case"resizeImageQuality":case"resizeIfSizeMoreThan":case"progressUploadThreshold":case"initialPreviewCount":case"zoomModalHeight":case"minImageHeight":case"maxImageHeight":case"minImageWidth":case"maxImageWidth":s[e]=t.getNum(i);break;default:s[e]=i}}),s.rtl&&(l=s.previewZoomButtonIcons.prev,s.previewZoomButtonIcons.prev=s.previewZoomButtonIcons.next,s.previewZoomButtonIcons.next=l),a||s._cleanup(),s.$form=d.closest("form"),s._initTemplateDefaults(),s.uploadFileAttr=t.isEmpty(d.attr("name"))?"file_data":d.attr("name"),o=s._getLayoutTemplate("progress"),s.progressTemplate=o.replace("{class}",s.progressClass),s.progressCompleteTemplate=o.replace("{class}",s.progressCompleteClass),s.progressErrorTemplate=o.replace("{class}",s.progressErrorClass),s.dropZoneEnabled=t.hasDragDropSupport()&&s.dropZoneEnabled,s.isDisabled=d.attr("disabled")||d.attr("readonly"),s.isDisabled&&d.attr("disabled",!0),s.isAjaxUpload=t.hasFileUploadSupport()&&!t.isEmpty(s.uploadUrl),s.isClickable=s.browseOnZoneClick&&s.showPreview&&(s.isAjaxUpload&&s.dropZoneEnabled||!t.isEmpty(s.defaultPreviewContent)),s.slug="function"==typeof i.slugCallback?i.slugCallback:s._slugDefault,s.mainTemplate=s.showCaption?s._getLayoutTemplate("main1"):s._getLayoutTemplate("main2"),s.captionTemplate=s._getLayoutTemplate("caption"),s.previewGenericTemplate=s._getPreviewTemplate("generic"),!s.imageCanvas&&s.resizeImage&&(s.maxImageWidth||s.maxImageHeight)&&(s.imageCanvas=document.createElement("canvas"),s.imageCanvasContext=s.imageCanvas.getContext("2d")),t.isEmpty(d.attr("id"))&&d.attr("id",t.uniqId()),s.namespace=".fileinput_"+d.attr("id").replace(/-/g,"_"),void 0===s.$container?s.$container=s._createContainer():s._refreshContainer(),r=s.$container,s.$dropZone=r.find(".file-drop-zone"),s.$progress=r.find(".kv-upload-progress"),s.$btnUpload=r.find(".fileinput-upload"),s.$captionContainer=t.getElement(i,"elCaptionContainer",r.find(".file-caption")),s.$caption=t.getElement(i,"elCaptionText",r.find(".file-caption-name")),t.isEmpty(s.msgPlaceholder)||(n=d.attr("multiple")?s.filePlural:s.fileSingle,s.$caption.attr("placeholder",s.msgPlaceholder.replace("{files}",n))),s.$captionIcon=s.$captionContainer.find(".file-caption-icon"),s.$previewContainer=t.getElement(i,"elPreviewContainer",r.find(".file-preview")),s.$preview=t.getElement(i,"elPreviewImage",r.find(".file-preview-thumbnails")),s.$previewStatus=t.getElement(i,"elPreviewStatus",r.find(".file-preview-status")),s.$errorContainer=t.getElement(i,"elErrorContainer",s.$previewContainer.find(".kv-fileinput-error")),s._validateDisabled(),t.isEmpty(s.msgErrorClass)||t.addCss(s.$errorContainer,s.msgErrorClass),a||(s.$errorContainer.hide(),s.previewInitId="preview-"+t.uniqId(),s._initPreviewCache(),s._initPreview(!0),s._initPreviewActions(),s._setFileDropZoneTitle(),s.$parent.hasClass("file-loading")&&(s.$container.insertBefore(s.$parent),s.$parent.remove())),d.attr("disabled")&&s.disable(),s._initZoom(),s.hideThumbnailContent&&t.addCss(s.$preview,"hide-content")},_initTemplateDefaults:function(){var i,a,n,r,o,l,s,d,c,u,p,f,h,m,v,g,w,_,b,C,y,x,T,E,S,k,F,P,D,I,A,z,$,j,U,B,O,R,L,M=this;i='{preview}\n<div class="kv-upload-progress kv-hidden"></div><div class="clearfix"></div>\n<div class="input-group {class}">\n  {caption}\n<div class="input-group-btn input-group-append">\n      {remove}\n      {cancel}\n      {upload}\n      {browse}\n    </div>\n</div>',a='{preview}\n<div class="kv-upload-progress kv-hidden"></div>\n<div class="clearfix"></div>\n{remove}\n{cancel}\n{upload}\n{browse}\n',n='<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    </div>\n    <div class="clearfix"></div>    <div class="file-preview-status text-center text-success"></div>\n    <div class="kv-fileinput-error"></div>\n    </div>\n</div>',o=t.closeButton("fileinput-remove"),r='<i class="glyphicon glyphicon-file"></i>',l='<div class="file-caption form-control {class}" tabindex="500">\n  <span class="file-caption-icon"></span>\n  <input class="file-caption-name" onkeydown="return false;" onpaste="return false;">\n</div>',s='<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</button>',d='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}</a>',c='<div tabindex="500" class="{css}" {status}>{icon} {label}</div>',u='<div id="'+t.MODAL_ID+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+t.MODAL_ID+'Label"></div>',p='<div class="modal-dialog modal-lg{rtl}" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <h5 class="modal-title">{heading}</h5>\n      <span class="kv-zoom-title"></span>\n      <div class="kv-zoom-actions">{toggleheader}{fullscreen}{borderless}{close}</div>\n    </div>\n    <div class="modal-body">\n      <div class="floating-buttons"></div>\n      <div class="kv-zoom-body file-zoom-content {zoomFrameClass}"></div>\n{prev} {next}\n    </div>\n  </div>\n</div>\n',f='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     </div>\n</div>',h=" <samp>({sizeText})</samp>",m='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">\n        <div class="file-caption-info">{caption}</div>\n        <div class="file-size-info">{size}</div>\n    </div>\n    {progress}\n{indicator}\n{actions}\n</div>',v='<div class="file-actions">\n    <div class="file-footer-buttons">\n        {download} {upload} {delete} {zoom} {other}    </div>\n</div>\n{drag}\n<div class="clearfix"></div>',g='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}</button>\n',w='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}</button>',_='<a class="kv-file-download {downloadClass}" title="{downloadTitle}" href="{downloadUrl}" download="{caption}" target="_blank">{downloadIcon}</a>',b='<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}</button>',C='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}</span>',y='<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}</div>',x='<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"',T=x+'><div class="kv-file-content">\n',E=x+' title="{caption}"><div class="kv-file-content">\n',S="</div>{footer}\n</div>\n",k="{content}\n",O=" {style}",F='<div class="kv-preview-data file-preview-html" title="{caption}"'+O+">{data}</div>\n",P='<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" alt="{caption}"'+O+">\n",D='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly'+O+">{data}</textarea>\n",I='<iframe class="kv-preview-data file-preview-office" src="https://docs.google.com/gview?url={data}&embedded=true"'+O+"></iframe>",A='<video class="kv-preview-data file-preview-video" controls'+O+'>\n<source src="{data}" type="{type}">\n'+t.DEFAULT_PREVIEW+"\n</video>\n",z='\x3c!--suppress ALL --\x3e<audio class="kv-preview-data file-preview-audio" controls'+O+'>\n<source src="{data}" type="{type}">\n'+t.DEFAULT_PREVIEW+"\n</audio>\n",
$='<embed class="kv-preview-data file-preview-flash" src="{data}" type="application/x-shockwave-flash"'+O+">\n",U='<embed class="kv-preview-data file-preview-pdf" src="{data}" type="application/pdf"'+O+">\n",j='<object class="kv-preview-data file-preview-object file-object {typeCss}" data="{data}" type="{type}"'+O+'>\n<param name="movie" value="{caption}" />\n'+t.OBJECT_PARAMS+" "+t.DEFAULT_PREVIEW+"\n</object>\n",B='<div class="kv-preview-data file-preview-other-frame"'+O+">\n"+t.DEFAULT_PREVIEW+"\n</div>\n",R='<div class="kv-zoom-cache" style="display:none">{zoomContent}</div>',L={width:"100%",height:"100%","min-height":"480px"},M.defaults={layoutTemplates:{main1:i,main2:a,preview:n,close:o,fileIcon:r,caption:l,modalMain:u,modal:p,progress:f,size:h,footer:m,indicator:y,actions:v,actionDelete:g,actionUpload:w,actionDownload:_,actionZoom:b,actionDrag:C,btnDefault:s,btnLink:d,btnBrowse:c,zoomCache:R},previewMarkupTags:{tagBefore1:T,tagBefore2:E,tagAfter:S},previewContentTemplates:{generic:k,html:F,image:P,text:D,office:I,video:A,audio:z,flash:$,object:j,pdf:U,other:B},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},office:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"100%",height:"30px"},flash:{width:"213px",height:"160px"},object:{width:"213px",height:"160px"},pdf:{width:"213px",height:"160px"},other:{width:"213px",height:"160px"}},previewSettingsSmall:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"160px"},text:{width:"100%",height:"160px"},office:{width:"100%",height:"160px"},video:{width:"100%",height:"auto"},audio:{width:"100%",height:"30px"},flash:{width:"100%",height:"auto"},object:{width:"100%",height:"auto"},pdf:{width:"100%",height:"160px"},other:{width:"100%",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:L,text:L,office:{width:"100%",height:"100%","max-width":"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","max-width":"100%","min-height":"480px"},pdf:L,other:{width:"auto",height:"100%","min-height":"480px"}},fileTypeSettings:{image:function(e,i){return t.compare(e,"image.*")&&!t.compare(e,/(tiff?|wmf)$/i)||t.compare(i,/\.(gif|png|jpe?g)$/i)},html:function(e,i){return t.compare(e,"text/html")||t.compare(i,/\.(htm|html)$/i)},office:function(e,i){return t.compare(e,/(word|excel|powerpoint|office|iwork-pages|tiff?)$/i)||t.compare(i,/\.(rtf|docx?|xlsx?|pptx?|pps|potx?|ods|odt|pages|ai|dxf|ttf|tiff?|wmf|e?ps)$/i)},text:function(e,i){return t.compare(e,"text.*")||t.compare(i,/\.(xml|javascript)$/i)||t.compare(i,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(e,i){return t.compare(e,"video.*")&&(t.compare(e,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||t.compare(i,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(e,i){return t.compare(e,"audio.*")&&(t.compare(i,/(ogg|mp3|mp?g|wav)$/i)||t.compare(i,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(e,i){return t.compare(e,"application/x-shockwave-flash",!0)||t.compare(i,/\.(swf)$/i)},pdf:function(e,i){return t.compare(e,"application/pdf",!0)||t.compare(i,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showDownload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",removeErrorClass:"btn btn-sm btn-kv btn-danger",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",uploadTitle:"Upload file",uploadRetryIcon:'<i class="glyphicon glyphicon-repeat"></i>',uploadRetryTitle:"Retry upload",downloadIcon:'<i class="glyphicon glyphicon-download"></i>',downloadClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",downloadTitle:"Download file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"></i>',zoomClass:"btn btn-sm btn-kv btn-default btn-outline-secondary",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-move"></i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-plus-sign text-warning"></i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"></i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"></i>',indicatorLoading:'<i class="glyphicon glyphicon-hourglass text-muted"></i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."}},e.each(M.defaults,function(t,i){return"allowedPreviewTypes"===t?void(void 0===M.allowedPreviewTypes&&(M.allowedPreviewTypes=i)):void(M[t]=e.extend(!0,{},i,M[t]))}),M._initPreviewTemplates()},_initPreviewTemplates:function(){var i,a=this,n=a.defaults,r=a.previewMarkupTags,o=r.tagAfter;e.each(n.previewContentTemplates,function(e,n){t.isEmpty(a.previewTemplates[e])&&(i=r.tagBefore2,"generic"!==e&&"image"!==e&&"html"!==e&&"text"!==e||(i=r.tagBefore1),a.previewTemplates[e]=i+n+o)})},_initPreviewCache:function(){var i=this;i.previewCache={data:{},init:function(){var e=i.initialPreview;e.length>0&&!t.isArray(e)&&(e=e.split(i.initialPreviewDelimiter)),i.previewCache.data={content:e,config:i.initialPreviewConfig,tags:i.initialPreviewThumbTags}},count:function(){return i.previewCache.data&&i.previewCache.data.content?i.previewCache.data.content.length:0},get:function(a,n){var r,o,l,s,d,c,u,p="init_"+a,f=i.previewCache.data,h=f.config[a],m=f.content[a],v=i.previewInitId+"-"+p,g=t.ifSet("previewAsData",h,i.initialPreviewAsData),w=function(e,a,n,r,o,l,s,d,c){return d=" file-preview-initial "+t.SORT_CSS+(d?" "+d:""),i._generatePreviewTemplate(e,a,n,r,o,!1,null,d,l,s,c)};return m?(n=void 0===n||n,l=t.ifSet("type",h,i.initialPreviewFileType||"generic"),d=t.ifSet("filename",h,t.ifSet("caption",h)),c=t.ifSet("filetype",h,l),s=i.previewCache.footer(a,n,h&&h.size||null),u=t.ifSet("frameClass",h),r=g?w(l,m,d,c,v,s,p,u):w("generic",m,d,c,v,s,p,u,l).setTokens({content:f.content[a]}),f.tags.length&&f.tags[a]&&(r=t.replaceTags(r,f.tags[a])),t.isEmpty(h)||t.isEmpty(h.frameAttr)||(o=e(document.createElement("div")).html(r),o.find(".file-preview-initial").attr(h.frameAttr),r=o.html(),o.remove()),r):""},add:function(e,a,n,r){var o,l=i.previewCache.data;return t.isArray(e)||(e=e.split(i.initialPreviewDelimiter)),r?(o=l.content.push(e)-1,l.config[o]=a,l.tags[o]=n):(o=e.length-1,l.content=e,l.config=a,l.tags=n),i.previewCache.data=l,o},set:function(e,a,n,r){var o,l,s=i.previewCache.data;if(e&&e.length&&(t.isArray(e)||(e=e.split(i.initialPreviewDelimiter)),l=e.filter(function(e){return null!==e}),l.length)){if(void 0===s.content&&(s.content=[]),void 0===s.config&&(s.config=[]),void 0===s.tags&&(s.tags=[]),r){for(o=0;o<e.length;o++)e[o]&&s.content.push(e[o]);for(o=0;o<a.length;o++)a[o]&&s.config.push(a[o]);for(o=0;o<n.length;o++)n[o]&&s.tags.push(n[o])}else s.content=e,s.config=a,s.tags=n;i.previewCache.data=s}},unset:function(e){var a=i.previewCache.count(),n=i.reversePreviewOrder;if(a){if(1===a)return i.previewCache.data.content=[],i.previewCache.data.config=[],i.previewCache.data.tags=[],i.initialPreview=[],i.initialPreviewConfig=[],void(i.initialPreviewThumbTags=[]);i.previewCache.data.content=t.spliceArray(i.previewCache.data.content,e,n),i.previewCache.data.config=t.spliceArray(i.previewCache.data.config,e,n),i.previewCache.data.tags=t.spliceArray(i.previewCache.data.tags,e,n)}},out:function(){var e,t,a,n="",r=i.previewCache.count();if(0===r)return{content:"",caption:""};for(t=0;r>t;t++)a=i.previewCache.get(t),n=i.reversePreviewOrder?a+n:n+a;return e=i._getMsgSelected(r),{content:n,caption:e}},footer:function(e,a,n){var r=i.previewCache.data||{};if(t.isEmpty(r.content))return"";(t.isEmpty(r.config)||t.isEmpty(r.config[e]))&&(r.config[e]={}),a=void 0===a||a;var o,l=r.config[e],s=t.ifSet("caption",l),d=t.ifSet("width",l,"auto"),c=t.ifSet("url",l,!1),u=t.ifSet("key",l,null),p=i.fileActionSettings,f=i.initialPreviewShowDelete||!1,h=l.downloadUrl||i.initialPreviewDownloadUrl||"",m=l.filename||l.caption||"",v=!!h,g=t.ifSet("showRemove",l,t.ifSet("showRemove",p,f)),w=t.ifSet("showDownload",l,t.ifSet("showDownload",p,v)),_=t.ifSet("showZoom",l,t.ifSet("showZoom",p,!0)),b=t.ifSet("showDrag",l,t.ifSet("showDrag",p,!0)),C=!1===c&&a;return w=w&&!1!==l.downloadUrl&&!!h,o=i._renderFileActions(!1,w,g,_,b,C,c,u,!0,h,m),i._getLayoutTemplate("footer").setTokens({progress:i._renderThumbProgress(),actions:o,caption:s,size:i._getSize(n),width:d,indicator:""})}},i.previewCache.init()},_handler:function(e,t,i){var a=this,n=a.namespace,r=t.split(" ").join(n+" ")+n;e&&e.length&&e.off(r).on(r,i)},_log:function(e){var t=this,i=t.$element.attr("id");i&&(e='"'+i+'": '+e),void 0!==window.console.log?window.console.log(e):window.alert(e)},_validate:function(){var e=this,t="file"===e.$element.attr("type");return t||e._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.'),t},_errorsExist:function(){var t,i=this;return!!i.$errorContainer.find("li").length||(t=e(document.createElement("div")).html(i.$errorContainer.html()),t.find(".kv-error-close").remove(),t.find("ul").remove(),!!e.trim(t.text()).length)},_errorHandler:function(e,t){var i=this,a=e.target.error;!function(e){i._showError(e.replace("{name}",t))}(a.code===a.NOT_FOUND_ERR?i.msgFileNotFound:a.code===a.SECURITY_ERR?i.msgFileSecured:a.code===a.NOT_READABLE_ERR?i.msgFileNotReadable:a.code===a.ABORT_ERR?i.msgFilePreviewAborted:i.msgFilePreviewError)},_addError:function(e){var t=this,i=t.$errorContainer;e&&i.length&&(i.html(t.errorCloseButton+e),t._handler(i.find(".kv-error-close"),"click",function(){setTimeout(function(){t.showPreview&&!t.getFrames().length&&t.clear(),i.fadeOut("slow")},10)}))},_setValidationError:function(e){var i=this;e=(e?e+" ":"")+"has-error",i.$container.removeClass(e).addClass("has-error"),t.addCss(i.$captionContainer,"is-invalid")},_resetErrors:function(e){var t=this,i=t.$errorContainer;t.isError=!1,t.$container.removeClass("has-error"),t.$captionContainer.removeClass("is-invalid"),i.html(""),e?i.fadeOut("slow"):i.hide()},_showFolderError:function(e){var t,i=this,a=i.$errorContainer;e&&(t=i.msgFoldersNotAllowed.replace("{n}",e),i._addError(t),i._setValidationError(),a.fadeIn(800),i._raise("filefoldererror",[e,t]))},_showUploadError:function(e,t,i){var a=this,n=a.$errorContainer,r=i||"fileuploaderror",o=t&&t.id?'<li data-file-id="'+t.id+'">'+e+"</li>":"<li>"+e+"</li>";return 0===n.find("ul").length?a._addError("<ul>"+o+"</ul>"):n.find("ul").append(o),n.fadeIn(800),a._raise(r,[t,e]),a._setValidationError("file-input-new"),!0},_showError:function(e,t,i){var a=this,n=a.$errorContainer,r=i||"fileerror";return t=t||{},t.reader=a.reader,a._addError(e),n.fadeIn(800),a._raise(r,[t,e]),a.isAjaxUpload||a._clearFileInput(),a._setValidationError("file-input-new"),a.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(e){var t=this,i=t.minFileCount>1?t.filePlural:t.fileSingle,a=t.msgFilesTooLess.replace("{n}",t.minFileCount).replace("{files}",i),n=t.$errorContainer;t._addError(a),t.isError=!0,t._updateFileDetails(0),n.fadeIn(800),t._raise("fileerror",[e,a]),t._clearFileInput(),t._setValidationError()},_parseError:function(t,i,a,n){var r,o=this,l=e.trim(a+""),s=void 0!==i.responseJSON&&void 0!==i.responseJSON.error?i.responseJSON.error:i.responseText;return o.cancelling&&o.msgUploadAborted&&(l=o.msgUploadAborted),o.showAjaxErrorDetails&&s&&(s=e.trim(s.replace(/\n\s*\n/g,"\n")),r=s.length?"<pre>"+s+"</pre>":"",l+=l?r:s),l||(l=o.msgAjaxError.replace("{operation}",t)),o.cancelling=!1,n?"<b>"+n+": </b>"+l:l},_parseFileType:function(e,i){var a,n,r,o,l=this,s=l.allowedPreviewTypes||[];if("application/text-plain"===e)return"text";for(o=0;o<s.length;o++)if(r=s[o],a=l.fileTypeSettings[r],n=a(e,i)?r:"",!t.isEmpty(n))return n;return"other"},_getPreviewIcon:function(t){var i,a=this,n=null;return t&&t.indexOf(".")>-1&&(i=t.split(".").pop(),a.previewFileIconSettings&&(n=a.previewFileIconSettings[i]||a.previewFileIconSettings[i.toLowerCase()]||null),a.previewFileExtSettings&&e.each(a.previewFileExtSettings,function(e,t){return a.previewFileIconSettings[e]&&t(i)?void(n=a.previewFileIconSettings[e]):void 0})),n},_parseFilePreviewIcon:function(e,t){var i=this,a=i._getPreviewIcon(t)||i.previewFileIcon,n=e;return n.indexOf("{previewFileIcon}")>-1&&(n=n.setTokens({previewFileIconClass:i.previewFileIconClass,previewFileIcon:a})),n},_raise:function(t,i){var a=this,n=e.Event(t);if(void 0!==i?a.$element.trigger(n,i):a.$element.trigger(n),n.isDefaultPrevented()||!1===n.result)return!1;switch(t){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:a.ajaxAborted||(a.ajaxAborted=n.result)}return!0},_listenFullScreen:function(e){var t,i,a=this,n=a.$modal;n&&n.length&&(t=n&&n.find(".btn-fullscreen"),i=n&&n.find(".btn-borderless"),t.length&&i.length&&(t.removeClass("active").attr("aria-pressed","false"),i.removeClass("active").attr("aria-pressed","false"),e?t.addClass("active").attr("aria-pressed","true"):i.addClass("active").attr("aria-pressed","true"),n.hasClass("file-zoom-fullscreen")?a._maximizeZoomDialog():e?a._maximizeZoomDialog():i.removeClass("active").attr("aria-pressed","false")))},_listen:function(){var i,a=this,n=a.$element,r=a.$form,o=a.$container;a._handler(n,"change",e.proxy(a._change,a)),a.showBrowse&&a._handler(a.$btnFile,"click",e.proxy(a._browse,a)),a._handler(o.find(".fileinput-remove:not([disabled])"),"click",e.proxy(a.clear,a)),a._handler(o.find(".fileinput-cancel"),"click",e.proxy(a.cancel,a)),a._initDragDrop(),a._handler(r,"reset",e.proxy(a.clear,a)),a.isAjaxUpload||a._handler(r,"submit",e.proxy(a._submitForm,a)),a._handler(a.$container.find(".fileinput-upload"),"click",e.proxy(a._uploadClick,a)),a._handler(e(window),"resize",function(){a._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)}),i="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange",a._handler(e(document),i,function(){a._listenFullScreen(t.checkFullScreen())}),a._autoFitContent(),a._initClickable()},_autoFitContent:function(){var t,i=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,a=this,n=400>i?a.previewSettingsSmall||a.defaults.previewSettingsSmall:a.previewSettings||a.defaults.previewSettings;e.each(n,function(e,i){t=".file-preview-frame .file-preview-"+e,a.$preview.find(t+".kv-preview-data,"+t+" .kv-preview-data").css(i)})},_initClickable:function(){var i,a=this;a.isClickable&&(i=a.isAjaxUpload?a.$dropZone:a.$preview.find(".file-default-preview"),t.addCss(i,"clickable"),i.attr("tabindex",-1),a._handler(i,"click",function(t){var n=e(t.target);i.find(".kv-fileinput-error:visible").length||n.parents(".file-preview-thumbnails").length&&!n.parents(".file-default-preview").length||(a.$element.trigger("click"),i.blur())}))},_initDragDrop:function(){var t=this,i=t.$dropZone;t.isAjaxUpload&&t.dropZoneEnabled&&t.showPreview&&(t._handler(i,"dragenter dragover",e.proxy(t._zoneDragEnter,t)),t._handler(i,"dragleave",e.proxy(t._zoneDragLeave,t)),t._handler(i,"drop",e.proxy(t._zoneDrop,t)),t._handler(e(document),"dragenter dragover drop",t._zoneDragDropInit))},_zoneDragDropInit:function(e){e.stopPropagation(),e.preventDefault()},_zoneDragEnter:function(i){var a=this,n=e.inArray("Files",i.originalEvent.dataTransfer.types)>-1;return a._zoneDragDropInit(i),a.isDisabled||!n?(i.originalEvent.dataTransfer.effectAllowed="none",void(i.originalEvent.dataTransfer.dropEffect="none")):void t.addCss(a.$dropZone,"file-highlighted")},_zoneDragLeave:function(e){var t=this;t._zoneDragDropInit(e),t.isDisabled||t.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(e){var i=this;e.preventDefault(),i.isDisabled||t.isEmpty(e.originalEvent.dataTransfer.files)||(i._change(e,"dragdrop"),i.$dropZone.removeClass("file-highlighted"))},_uploadClick:function(e){var i,a=this,n=a.$container.find(".fileinput-upload"),r=!n.hasClass("disabled")&&t.isEmpty(n.attr("disabled"));if(!e||!e.isDefaultPrevented()){if(!a.isAjaxUpload)return void(r&&"submit"!==n.attr("type")&&(i=n.closest("form"),i.length&&i.trigger("submit"),e.preventDefault()));e.preventDefault(),r&&a.upload()}},_submitForm:function(){var e=this;return e._isFileSelectionValid()&&!e._abort({})},_clearPreview:function(){var i=this,a=i.$preview;(i.showUploadedThumbs?i.getFrames(":not(.file-preview-success)"):i.getFrames()).each(function(){var i=e(this);i.remove(),t.cleanZoomCache(a.find("#zoom-"+i.attr("id")))}),i.getFrames().length&&i.showPreview||i._resetUpload(),i._validateDefaultPreview()},_initSortable:function(){var i,a=this,n=a.$preview,r="."+t.SORT_CSS,o=a.reversePreviewOrder;window.KvSortable&&0!==n.find(r).length&&(i={handle:".drag-handle-init",dataIdAttr:"data-preview-id",scroll:!1,draggable:r,onSort:function(i){var n=i.oldIndex,r=i.newIndex,l=0;a.initialPreview=t.moveArray(a.initialPreview,n,r,o),a.initialPreviewConfig=t.moveArray(a.initialPreviewConfig,n,r,o),a.previewCache.init(),a.getFrames(".file-preview-initial").each(function(){e(this).attr("data-fileindex","init_"+l),l++}),a._raise("filesorted",{previewId:e(i.item).attr("id"),oldIndex:n,newIndex:r,stack:a.initialPreviewConfig})}},n.data("kvsortable")&&n.kvsortable("destroy"),e.extend(!0,i,a.fileActionSettings.dragSettings),n.kvsortable(i))},_setPreviewContent:function(e){var t=this;t.$preview.html(e),t._autoFitContent()},_initPreview:function(e){var i,a=this,n=a.initialCaption||"";return a.previewCache.count()?(i=a.previewCache.out(),n=e&&a.initialCaption?a.initialCaption:i.caption,a._setPreviewContent(i.content),a._setInitThumbAttr(),a._setCaption(n),a._initSortable(),void(t.isEmpty(i.content)||a.$container.removeClass("file-input-new"))):(a._clearPreview(),void(e?a._setCaption(n):a._initCaption()))},_getZoomButton:function(e){var t=this,i=t.previewZoomButtonIcons[e],a=t.previewZoomButtonClasses[e],n=' title="'+(t.previewZoomButtonTitles[e]||"")+'" ',r=n+("close"===e?' data-dismiss="modal" aria-hidden="true"':"");return"fullscreen"!==e&&"borderless"!==e&&"toggleheader"!==e||(r+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+a+" btn-"+e+'"'+r+">"+i+"</button>"},_getModalContent:function(){var e=this;return e._getLayoutTemplate("modal").setTokens({rtl:e.rtl?" kv-rtl":"",zoomFrameClass:e.frameClass,heading:e.msgZoomModalHeading,prev:e._getZoomButton("prev"),next:e._getZoomButton("next"),toggleheader:e._getZoomButton("toggleheader"),fullscreen:e._getZoomButton("fullscreen"),borderless:e._getZoomButton("borderless"),close:e._getZoomButton("close")})},_listenModalEvent:function(e){var i=this,a=i.$modal,n=function(e){return{sourceEvent:e,previewId:a.data("previewId"),modal:a}};a.on(e+".bs.modal",function(r){var o=a.find(".btn-fullscreen"),l=a.find(".btn-borderless");i._raise("filezoom"+e,n(r)),"shown"===e&&(l.removeClass("active").attr("aria-pressed","false"),o.removeClass("active").attr("aria-pressed","false"),a.hasClass("file-zoom-fullscreen")&&(i._maximizeZoomDialog(),t.checkFullScreen()?o.addClass("active").attr("aria-pressed","true"):l.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var i,a=this,n=a._getLayoutTemplate("modalMain"),r="#"+t.MODAL_ID;a.showPreview&&(a.$modal=e(r),a.$modal&&a.$modal.length||(i=e(document.createElement("div")).html(n).insertAfter(a.$container),a.$modal=e(r).insertBefore(i),i.remove()),t.initModal(a.$modal),a.$modal.html(a._getModalContent()),e.each(t.MODAL_EVENTS,function(e,t){a._listenModalEvent(t)}))},_initZoomButtons:function(){var t,i,a=this,n=a.$modal.data("previewId")||"",r=a.getFrames().toArray(),o=r.length,l=a.$modal.find(".btn-prev"),s=a.$modal.find(".btn-next");return r.length<2?(l.hide(),void s.hide()):(l.show(),s.show(),void(o&&(t=e(r[0]),i=e(r[o-1]),l.removeAttr("disabled"),s.removeAttr("disabled"),t.length&&t.attr("id")===n&&l.attr("disabled",!0),i.length&&i.attr("id")===n&&s.attr("disabled",!0))))},_maximizeZoomDialog:function(){var t=this,i=t.$modal,a=i.find(".modal-header:visible"),n=i.find(".modal-footer:visible"),r=i.find(".modal-body"),o=e(window).height(),l=0;i.addClass("file-zoom-fullscreen"),a&&a.length&&(o-=a.outerHeight(!0)),n&&n.length&&(o-=n.outerHeight(!0)),r&&r.length&&(l=r.outerHeight(!0)-r.height(),o-=l),i.find(".kv-zoom-body").height(o)},_resizeZoomDialog:function(e){var i=this,a=i.$modal,n=a.find(".btn-fullscreen"),r=a.find(".btn-borderless");if(a.hasClass("file-zoom-fullscreen"))t.toggleFullScreen(!1),e?n.hasClass("active")||(a.removeClass("file-zoom-fullscreen"),i._resizeZoomDialog(!0),r.hasClass("active")&&r.removeClass("active").attr("aria-pressed","false")):n.hasClass("active")?n.removeClass("active").attr("aria-pressed","false"):(a.removeClass("file-zoom-fullscreen"),i.$modal.find(".kv-zoom-body").css("height",i.zoomModalHeight));else{if(!e)return void i._maximizeZoomDialog();t.toggleFullScreen(!0)}a.focus()},_setZoomContent:function(i,a){var n,r,o,l,s,d,c,u,p,f,h=this,m=i.attr("id"),v=h.$modal,g=v.find(".btn-prev"),w=v.find(".btn-next"),_=v.find(".btn-fullscreen"),b=v.find(".btn-borderless"),C=v.find(".btn-toggleheader"),y=h.$preview.find("#zoom-"+m);r=y.attr("data-template")||"generic",n=y.find(".kv-file-content"),o=n.length?n.html():"",p=i.data("caption")||"",f=i.data("size")||"",l=p+" "+f,v.find(".kv-zoom-title").attr("title",e("<div/>").html(l).text()).html(l),s=v.find(".kv-zoom-body"),v.removeClass("kv-single-content"),a?(u=s.addClass("file-thumb-loading").clone().insertAfter(s),s.html(o).hide(),u.fadeOut("fast",function(){s.fadeIn("fast",function(){s.removeClass("file-thumb-loading")}),u.remove()})):s.html(o),c=h.previewZoomSettings[r],c&&(d=s.find(".kv-preview-data"),t.addCss(d,"file-zoom-detail"),e.each(c,function(e,t){d.css(e,t),(d.attr("width")&&"width"===e||d.attr("height")&&"height"===e)&&d.removeAttr(e)})),v.data("previewId",m);var x=s.find("img");x.length&&t.adjustOrientedImage(x,!0),h._handler(g,"click",function(){h._zoomSlideShow("prev",m)}),h._handler(w,"click",function(){h._zoomSlideShow("next",m)}),h._handler(_,"click",function(){h._resizeZoomDialog(!0)}),h._handler(b,"click",function(){h._resizeZoomDialog(!1)}),h._handler(C,"click",function(){var e,t=v.find(".modal-header"),i=v.find(".modal-body .floating-buttons"),a=t.find(".kv-zoom-actions"),n=function(e){var i=h.$modal.find(".kv-zoom-body"),a=h.zoomModalHeight;v.hasClass("file-zoom-fullscreen")&&(a=i.outerHeight(!0),e||(a-=t.outerHeight(!0))),i.css("height",e?a+e:a)};t.is(":visible")?(e=t.outerHeight(!0),t.slideUp("slow",function(){a.find(".btn").appendTo(i),n(e)})):(i.find(".btn").appendTo(a),t.slideDown("slow",function(){n()})),v.focus()}),h._handler(v,"keydown",function(e){var t=e.which||e.keyCode;37!==t||g.attr("disabled")||h._zoomSlideShow("prev",m),39!==t||w.attr("disabled")||h._zoomSlideShow("next",m)})},_zoomPreview:function(e){var i,a=this,n=a.$modal;if(!e.length)throw"Cannot zoom to detailed preview!";t.initModal(n),n.html(a._getModalContent()),i=e.closest(t.FRAMES),a._setZoomContent(i),n.modal("show"),a._initZoomButtons()},_zoomSlideShow:function(t,i){var a,n,r,o=this,l=o.$modal.find(".kv-zoom-actions .btn-"+t),s=o.getFrames().toArray(),d=s.length;if(!l.attr("disabled")){for(n=0;d>n;n++)if(e(s[n]).attr("id")===i){r="prev"===t?n-1:n+1;break}0>r||r>=d||!s[r]||(a=e(s[r]),a.length&&o._setZoomContent(a,!0),o._initZoomButtons(),o._raise("filezoom"+t,{previewId:i,modal:o.$modal}))}},_initZoomButton:function(){var t=this;t.$preview.find(".kv-file-zoom").each(function(){var i=e(this);t._handler(i,"click",function(){t._zoomPreview(i)})})},_clearObjects:function(t){t.find("video audio").each(function(){this.pause(),e(this).remove()}),t.find("img object div").each(function(){e(this).remove()})},_clearFileInput:function(){var i,a,n,r=this,o=r.$element;r.fileInputCleared=!0,t.isEmpty(o.val())||(r.isIE9||r.isIE10?(i=o.closest("form"),a=e(document.createElement("form")),n=e(document.createElement("div")),o.before(n),i.length?i.after(a):n.after(a),a.append(o).trigger("reset"),n.before(o).remove(),a.remove()):o.val(""))},_resetUpload:function(){var e=this;e.uploadCache={content:[],config:[],tags:[],append:!0},e.uploadCount=0,e.uploadStatus={},e.uploadLog=[],e.uploadAsyncCount=0,e.loadedImages=[],e.totalImagesCount=0,e.$btnUpload.removeAttr("disabled"),e._setProgress(0),e.$progress.hide(),e._resetErrors(!1),e.ajaxAborted=!1,e.ajaxRequests=[],e._resetCanvas(),e.cacheInitialPreview={},e.overwriteInitial&&(e.initialPreview=[],e.initialPreviewConfig=[],e.initialPreviewThumbTags=[],e.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){var e=this;e.canvas&&e.imageCanvasContext&&e.imageCanvasContext.clearRect(0,0,e.canvas.width,e.canvas.height)},_hasInitialPreview:function(){var e=this;return!e.overwriteInitial&&e.previewCache.count()},_resetPreview:function(){var e,t,i=this;i.previewCache.count()?(e=i.previewCache.out(),i._setPreviewContent(e.content),i._setInitThumbAttr(),t=i.initialCaption?i.initialCaption:e.caption,i._setCaption(t)):(i._clearPreview(),i._initCaption()),i.showPreview&&(i._initZoom(),i._initSortable())},_clearDefaultPreview:function(){this.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var e=this;e.showPreview&&!t.isEmpty(e.defaultPreviewContent)&&(e._setPreviewContent('<div class="file-default-preview">'+e.defaultPreviewContent+"</div>"),e.$container.removeClass("file-input-new"),e._initClickable())},_resetPreviewThumbs:function(e){var t,i=this;return e?(i._clearPreview(),void i.clearStack()):void(i._hasInitialPreview()?(t=i.previewCache.out(),i._setPreviewContent(t.content),i._setInitThumbAttr(),i._setCaption(t.caption),i._initPreviewActions()):i._clearPreview())},_getLayoutTemplate:function(e){var i=this,a=i.layoutTemplates[e];return t.isEmpty(i.customLayoutTags)?a:t.replaceTags(a,i.customLayoutTags)},_getPreviewTemplate:function(e){var i=this,a=i.previewTemplates[e];return t.isEmpty(i.customPreviewTags)?a:t.replaceTags(a,i.customPreviewTags)},_getOutData:function(e,t,i){var a=this;return e=e||{},t=t||{},i=i||a.filestack.slice(0)||{},{form:a.formdata,files:i,filenames:a.filenames,filescount:a.getFilesCount(),extra:a._getExtraData(),response:t,reader:a.reader,jqXHR:e}},_getMsgSelected:function(e){var t=this,i=1===e?t.fileSingle:t.filePlural;return e>0?t.msgSelected.replace("{n}",e).replace("{files}",i):t.msgNoFilesSelected},_getFrame:function(t){var i=this,a=e("#"+t);return a.length?a:(i._log('Invalid thumb frame with id: "'+t+'".'),null)},_getThumbs:function(e){return e=e||"",this.getFrames(":not(.file-preview-initial)"+e)},_getExtraData:function(e,t){var i=this,a=i.uploadExtraData;return"function"==typeof i.uploadExtraData&&(a=i.uploadExtraData(e,t)),a},_initXhr:function(e,t,i){var a=this;return e.upload&&e.upload.addEventListener("progress",function(e){var n=0,r=e.total,o=e.loaded||e.position;e.lengthComputable&&(n=Math.floor(o/r*100)),t?a._setAsyncUploadStatus(t,n,i):a._setProgress(n)},!1),e},_mergeAjaxCallback:function(e,t,i){var a,n=this,r=n.ajaxSettings,o=n.mergeAjaxCallbacks;"delete"===i&&(r=n.ajaxDeleteSettings,o=n.mergeAjaxDeleteCallbacks),a=r[e],r[e]=o&&"function"==typeof a?"before"===o?function(){a.apply(this,arguments),t.apply(this,arguments)}:function(){t.apply(this,arguments),a.apply(this,arguments)}:t,"delete"===i?n.ajaxDeleteSettings=r:n.ajaxSettings=r},_ajaxSubmit:function(t,i,a,n,r,o){var l,s=this;s._raise("filepreajax",[r,o])&&(s._uploadExtra(r,o),s._mergeAjaxCallback("beforeSend",t),s._mergeAjaxCallback("success",i),s._mergeAjaxCallback("complete",a),s._mergeAjaxCallback("error",n),l=e.extend(!0,{},{xhr:function(){var t=e.ajaxSettings.xhr();return s._initXhr(t,r,s.getFileStack().length)},url:o&&s.uploadUrlThumb?s.uploadUrlThumb:s.uploadUrl,type:"POST",dataType:"json",data:s.formdata,cache:!1,processData:!1,contentType:!1},s.ajaxSettings),s.ajaxRequests.push(e.ajax(l)))},_mergeArray:function(e,i){var a=this,n=t.cleanArray(a[e]),r=t.cleanArray(i);a[e]=n.concat(r)},_initUploadSuccess:function(i,a,n){var r,o,l,s,d,c,u,p,f,h=this;h.showPreview&&"object"==typeof i&&!e.isEmptyObject(i)&&void 0!==i.initialPreview&&i.initialPreview.length>0&&(h.hasInitData=!0,c=i.initialPreview||[],u=i.initialPreviewConfig||[],p=i.initialPreviewThumbTags||[],r=void 0===i.append||i.append,c.length>0&&!t.isArray(c)&&(c=c.split(h.initialPreviewDelimiter)),h._mergeArray("initialPreview",c),h._mergeArray("initialPreviewConfig",u),h._mergeArray("initialPreviewThumbTags",p),void 0!==a?n?(f=a.attr("data-fileindex"),h.uploadCache.content[f]=c[0],h.uploadCache.config[f]=u[0]||[],h.uploadCache.tags[f]=p[0]||[],h.uploadCache.append=r):(l=h.previewCache.add(c,u[0],p[0],r),o=h.previewCache.get(l,!1),s=e(document.createElement("div")).html(o).hide().insertAfter(a),d=s.find(".kv-zoom-cache"),d&&d.length&&d.insertAfter(a),a.fadeOut("slow",function(){var e=s.find(".file-preview-frame");e&&e.length&&e.insertBefore(a).fadeIn("slow").css("display:inline-block"),h._initPreviewActions(),h._clearFileInput(),t.cleanZoomCache(h.$preview.find("#zoom-"+a.attr("id"))),a.remove(),s.remove(),h._initSortable()})):(h.previewCache.set(c,u,p,r),h._initPreview(),h._initPreviewActions()))},_initSuccessThumbs:function(){var i=this;i.showPreview&&i._getThumbs(t.FRAMES+".file-preview-success").each(function(){var a=e(this),n=i.$preview,r=a.find(".kv-file-remove");r.removeAttr("disabled"),i._handler(r,"click",function(){var e=a.attr("id"),r=i._raise("filesuccessremove",[e,a.attr("data-fileindex")]);t.cleanMemory(a),!1!==r&&a.fadeOut("slow",function(){t.cleanZoomCache(n.find("#zoom-"+e)),a.remove(),i.getFrames().length||i.reset()})})})},_checkAsyncComplete:function(){var t,i,a=this;for(i=0;i<a.filestack.length;i++)if(a.filestack[i]&&(t=a.previewInitId+"-"+i,-1===e.inArray(t,a.uploadLog)))return!1;return a.uploadAsyncCount===a.uploadLog.length},_uploadExtra:function(t,i){var a=this,n=a._getExtraData(t,i);0!==n.length&&e.each(n,function(e,t){a.formdata.append(e,t)})},_uploadSingle:function(i,a){var n,r,o,l,s,d,c,u,p,f,h,m=this,v=m.getFileStack().length,g=new FormData,w=m.previewInitId+"-"+i,_=m.filestack.length>0||!e.isEmptyObject(m.uploadExtraData),b=e("#"+w).find(".file-thumb-progress"),C={id:w,index:i};m.formdata=g,m.showPreview&&(r=e("#"+w+":not(.file-preview-initial)"),l=r.find(".kv-file-upload"),s=r.find(".kv-file-remove"),b.show()),0===v||!_||l&&l.hasClass("disabled")||m._abort(C)||(h=function(e,t){d||m.updateStack(e,void 0),m.uploadLog.push(t),m._checkAsyncComplete()&&(m.fileBatchCompleted=!0)},o=function(){var e,i,a,n=m.uploadCache,r=0,o=m.cacheInitialPreview;m.fileBatchCompleted&&(o&&o.content&&(r=o.content.length),setTimeout(function(){var l=0===m.getFileStack(!0).length;if(m.showPreview){if(m.previewCache.set(n.content,n.config,n.tags,n.append),r){for(i=0;i<n.content.length;i++)a=i+r,o.content[a]=n.content[i],o.config.length&&(o.config[a]=n.config[i]),o.tags.length&&(o.tags[a]=n.tags[i]);m.initialPreview=t.cleanArray(o.content),m.initialPreviewConfig=t.cleanArray(o.config),m.initialPreviewThumbTags=t.cleanArray(o.tags)}else m.initialPreview=n.content,m.initialPreviewConfig=n.config,m.initialPreviewThumbTags=n.tags;m.cacheInitialPreview={},m.hasInitData&&(m._initPreview(),m._initPreviewActions())}m.unlock(l),l&&m._clearFileInput(),e=m.$preview.find(".file-preview-initial"),m.uploadAsync&&e.length&&(t.addCss(e,t.SORT_CSS),m._initSortable()),
m._raise("filebatchuploadcomplete",[m.filestack,m._getExtraData()]),m.uploadCount=0,m.uploadStatus={},m.uploadLog=[],m._setProgress(101),m.ajaxAborted=!1},100))},c=function(o){n=m._getOutData(o),m.fileBatchCompleted=!1,a||(m.ajaxAborted=!1),m.showPreview&&(r.hasClass("file-preview-success")||(m._setThumbStatus(r,"Loading"),t.addCss(r,"file-uploading")),l.attr("disabled",!0),s.attr("disabled",!0)),a||m.lock(),m._raise("filepreupload",[n,w,i]),e.extend(!0,C,n),m._abort(C)&&(o.abort(),a||(m._setThumbStatus(r,"New"),r.removeClass("file-uploading"),l.removeAttr("disabled"),s.removeAttr("disabled"),m.unlock()),m._setProgressCancelled())},u=function(o,s,c){var u=m.showPreview&&r.attr("id")?r.attr("id"):w;n=m._getOutData(c,o),e.extend(!0,C,n),setTimeout(function(){t.isEmpty(o)||t.isEmpty(o.error)?(m.showPreview&&(m._setThumbStatus(r,"Success"),l.hide(),m._initUploadSuccess(o,r,a),m._setProgress(101,b)),m._raise("fileuploaded",[n,u,i]),a?h(i,u):m.updateStack(i,void 0)):(d=!0,m._showUploadError(o.error,C),m._setPreviewError(r,i,m.filestack[i],m.retryErrorUploads),m.retryErrorUploads||l.hide(),a&&h(i,u),m._setProgress(101,e("#"+u).find(".file-thumb-progress"),m.msgUploadError))},100)},p=function(){setTimeout(function(){m.showPreview&&(l.removeAttr("disabled"),s.removeAttr("disabled"),r.removeClass("file-uploading")),a?o():(m.unlock(!1),m._clearFileInput()),m._initSuccessThumbs()},100)},f=function(t,n,o){var s=m.ajaxOperations.uploadThumb,c=m._parseError(s,t,o,a&&m.filestack[i].name?m.filestack[i].name:null);d=!0,setTimeout(function(){a&&h(i,w),m.uploadStatus[w]=100,m._setPreviewError(r,i,m.filestack[i],m.retryErrorUploads),m.retryErrorUploads||l.hide(),e.extend(!0,C,m._getOutData(t)),m._setProgress(101,b,m.msgAjaxProgressError.replace("{operation}",s)),m._setProgress(101,e("#"+w).find(".file-thumb-progress"),m.msgUploadError),m._showUploadError(c,C)},100)},g.append(m.uploadFileAttr,m.filestack[i],m.filenames[i]),g.append("file_id",i),m._ajaxSubmit(c,u,p,f,w,i))},_uploadBatch:function(){var i,a,n,r,o,l=this,s=l.filestack,d=s.length,c={},u=l.filestack.length>0||!e.isEmptyObject(l.uploadExtraData);l.formdata=new FormData,0!==d&&u&&!l._abort(c)&&(o=function(){e.each(s,function(e){l.updateStack(e,void 0)}),l._clearFileInput()},i=function(i){l.lock();var a=l._getOutData(i);l.ajaxAborted=!1,l.showPreview&&l._getThumbs().each(function(){var i=e(this),a=i.find(".kv-file-upload"),n=i.find(".kv-file-remove");i.hasClass("file-preview-success")||(l._setThumbStatus(i,"Loading"),t.addCss(i,"file-uploading")),a.attr("disabled",!0),n.attr("disabled",!0)}),l._raise("filebatchpreupload",[a]),l._abort(a)&&(i.abort(),l._getThumbs().each(function(){var t=e(this),i=t.find(".kv-file-upload"),a=t.find(".kv-file-remove");t.hasClass("file-preview-loading")&&(l._setThumbStatus(t,"New"),t.removeClass("file-uploading")),i.removeAttr("disabled"),a.removeAttr("disabled")}),l._setProgressCancelled())},a=function(i,a,n){var r=l._getOutData(n,i),s=0,d=l._getThumbs(":not(.file-preview-success)"),c=t.isEmpty(i)||t.isEmpty(i.errorkeys)?[]:i.errorkeys;t.isEmpty(i)||t.isEmpty(i.error)?(l._raise("filebatchuploadsuccess",[r]),o(),l.showPreview?(d.each(function(){var t=e(this);l._setThumbStatus(t,"Success"),t.removeClass("file-uploading"),t.find(".kv-file-upload").hide().removeAttr("disabled")}),l._initUploadSuccess(i)):l.reset(),l._setProgress(101)):(l.showPreview&&(d.each(function(){var t=e(this),i=t.attr("data-fileindex");t.removeClass("file-uploading"),t.find(".kv-file-upload").removeAttr("disabled"),t.find(".kv-file-remove").removeAttr("disabled"),0===c.length||-1!==e.inArray(s,c)?(l._setPreviewError(t,i,l.filestack[i],l.retryErrorUploads),l.retryErrorUploads||(t.find(".kv-file-upload").hide(),l.updateStack(i,void 0))):(t.find(".kv-file-upload").hide(),l._setThumbStatus(t,"Success"),l.updateStack(i,void 0)),t.hasClass("file-preview-error")&&!l.retryErrorUploads||s++}),l._initUploadSuccess(i)),l._showUploadError(i.error,r,"filebatchuploaderror"),l._setProgress(101,l.$progress,l.msgUploadError))},r=function(){l.unlock(),l._initSuccessThumbs(),l._clearFileInput(),l._raise("filebatchuploadcomplete",[l.filestack,l._getExtraData()])},n=function(t,i,a){var n=l._getOutData(t),r=l.ajaxOperations.uploadBatch,o=l._parseError(r,t,a);l._showUploadError(o,n,"filebatchuploaderror"),l.uploadFileCount=d-1,l.showPreview&&(l._getThumbs().each(function(){var t=e(this),i=t.attr("data-fileindex");t.removeClass("file-uploading"),void 0!==l.filestack[i]&&l._setPreviewError(t)}),l._getThumbs().removeClass("file-uploading"),l._getThumbs(" .kv-file-upload").removeAttr("disabled"),l._getThumbs(" .kv-file-delete").removeAttr("disabled"),l._setProgress(101,l.$progress,l.msgAjaxProgressError.replace("{operation}",r)))},e.each(s,function(e,i){t.isEmpty(s[e])||l.formdata.append(l.uploadFileAttr,i,l.filenames[e])}),l._ajaxSubmit(i,a,r,n))},_uploadExtraOnly:function(){var e,i,a,n,r=this,o={};r.formdata=new FormData,r._abort(o)||(e=function(e){r.lock();var t=r._getOutData(e);r._raise("filebatchpreupload",[t]),r._setProgress(50),o.data=t,o.xhr=e,r._abort(o)&&(e.abort(),r._setProgressCancelled())},i=function(e,i,a){var n=r._getOutData(a,e);t.isEmpty(e)||t.isEmpty(e.error)?(r._raise("filebatchuploadsuccess",[n]),r._clearFileInput(),r._initUploadSuccess(e),r._setProgress(101)):r._showUploadError(e.error,n,"filebatchuploaderror")},a=function(){r.unlock(),r._clearFileInput(),r._raise("filebatchuploadcomplete",[r.filestack,r._getExtraData()])},n=function(e,t,i){var a=r._getOutData(e),n=r.ajaxOperations.uploadExtra,l=r._parseError(n,e,i);o.data=a,r._showUploadError(l,a,"filebatchuploaderror"),r._setProgress(101,r.$progress,r.msgAjaxProgressError.replace("{operation}",n))},r._ajaxSubmit(e,i,a,n))},_deleteFileIndex:function(i){var a=this,n=i.attr("data-fileindex"),r=a.reversePreviewOrder;"init_"===n.substring(0,5)&&(n=parseInt(n.replace("init_","")),a.initialPreview=t.spliceArray(a.initialPreview,n,r),a.initialPreviewConfig=t.spliceArray(a.initialPreviewConfig,n,r),a.initialPreviewThumbTags=t.spliceArray(a.initialPreviewThumbTags,n,r),a.getFrames().each(function(){var t=e(this),i=t.attr("data-fileindex");"init_"===i.substring(0,5)&&(i=parseInt(i.replace("init_","")))>n&&(i--,t.attr("data-fileindex","init_"+i))}),a.uploadAsync&&(a.cacheInitialPreview=a.getPreview()))},_initFileActions:function(){var i=this,a=i.$preview;i.showPreview&&(i._initZoomButton(),i.getFrames(" .kv-file-remove").each(function(){var n,r,o,l,s=e(this),d=s.closest(t.FRAMES),c=d.attr("id"),u=d.attr("data-fileindex");i._handler(s,"click",function(){return!(!1===(l=i._raise("filepreremove",[c,u]))||!i._validateMinCount())&&(n=d.hasClass("file-preview-error"),t.cleanMemory(d),void d.fadeOut("slow",function(){t.cleanZoomCache(a.find("#zoom-"+c)),i.updateStack(u,void 0),i._clearObjects(d),d.remove(),c&&n&&i.$errorContainer.find('li[data-file-id="'+c+'"]').fadeOut("fast",function(){e(this).remove(),i._errorsExist()||i._resetErrors()}),i._clearFileInput();var l=i.getFileStack(!0),s=i.previewCache.count(),p=l.length,f=i.showPreview&&i.getFrames().length;0!==p||0!==s||f?(r=s+p,o=r>1?i._getMsgSelected(r):l[0]?i._getFileNames()[0]:"",i._setCaption(o)):i.reset(),i._raise("fileremoved",[c,u])}))})}),i.getFrames(" .kv-file-upload").each(function(){var a=e(this);i._handler(a,"click",function(){var e=a.closest(t.FRAMES),n=e.attr("data-fileindex");i.$progress.hide(),e.hasClass("file-preview-error")&&!i.retryErrorUploads||i._uploadSingle(n,!1)})}))},_initPreviewActions:function(){var i=this,a=i.$preview,n=i.deleteExtraData||{},r=t.FRAMES+" .kv-file-remove",o=i.fileActionSettings,l=o.removeClass,s=o.removeErrorClass,d=function(){var e=i.isAjaxUpload?i.previewCache.count():i.$element.get(0).files.length;a.find(t.FRAMES).length||e||(i._setCaption(""),i.reset(),i.initialCaption="")};i._initZoomButton(),a.find(r).each(function(){var r,o,c,u=e(this),p=u.data("url")||i.deleteUrl,f=u.data("key");if(!t.isEmpty(p)&&void 0!==f){var h,m,v,g,w=u.closest(t.FRAMES),_=i.previewCache.data,b=w.attr("data-fileindex");b=parseInt(b.replace("init_","")),v=t.isEmpty(_.config)&&t.isEmpty(_.config[b])?null:_.config[b],g=t.isEmpty(v)||t.isEmpty(v.extra)?n:v.extra,"function"==typeof g&&(g=g()),m={id:u.attr("id"),key:f,extra:g},r=function(e){i.ajaxAborted=!1,i._raise("filepredelete",[f,e,g]),i._abort()?e.abort():(u.removeClass(s),t.addCss(w,"file-uploading"),t.addCss(u,"disabled "+l))},o=function(e,n,r){var o,c;return t.isEmpty(e)||t.isEmpty(e.error)?(w.removeClass("file-uploading").addClass("file-deleted"),void w.fadeOut("slow",function(){b=parseInt(w.attr("data-fileindex").replace("init_","")),i.previewCache.unset(b),i._deleteFileIndex(w),o=i.previewCache.count(),c=o>0?i._getMsgSelected(o):"",i._setCaption(c),i._raise("filedeleted",[f,r,g]),t.cleanZoomCache(a.find("#zoom-"+w.attr("id"))),i._clearObjects(w),w.remove(),d()})):(m.jqXHR=r,m.response=e,i._showError(e.error,m,"filedeleteerror"),w.removeClass("file-uploading"),u.removeClass("disabled "+l).addClass(s),void d())},c=function(e,t,a){var n=i.ajaxOperations.deleteThumb,r=i._parseError(n,e,a);m.jqXHR=e,m.response={},i._showError(r,m,"filedeleteerror"),w.removeClass("file-uploading"),u.removeClass("disabled "+l).addClass(s),d()},i._mergeAjaxCallback("beforeSend",r,"delete"),i._mergeAjaxCallback("success",o,"delete"),i._mergeAjaxCallback("error",c,"delete"),h=e.extend(!0,{},{url:p,type:"POST",dataType:"json",data:e.extend(!0,{},{key:f},g)},i.ajaxDeleteSettings),i._handler(u,"click",function(){return!!i._validateMinCount()&&(i.ajaxAborted=!1,i._raise("filebeforedelete",[f,g]),void(i.ajaxAborted instanceof Promise?i.ajaxAborted.then(function(t){t||e.ajax(h)}):i.ajaxAborted||e.ajax(h)))})}})},_hideFileIcon:function(){var e=this;e.overwriteInitial&&e.$captionContainer.removeClass("icon-visible")},_showFileIcon:function(){var e=this;t.addCss(e.$captionContainer,"icon-visible")},_getSize:function(t){var i,a,n,r=this,o=parseFloat(t),l=r.fileSizeGetter;return e.isNumeric(t)&&e.isNumeric(o)?("function"==typeof l?n=l(o):0===o?n="0.00 B":(i=Math.floor(Math.log(o)/Math.log(1024)),a=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],n=1*(o/Math.pow(1024,i)).toFixed(2)+" "+a[i]),r._getLayoutTemplate("size").replace("{sizeText}",n)):""},_generatePreviewTemplate:function(i,a,n,r,o,l,s,d,c,u,p){var f,h=this,m=h.slug(n),v="",g="",w=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,_=400>w?h.previewSettingsSmall[i]||h.defaults.previewSettingsSmall[i]:h.previewSettings[i]||h.defaults.previewSettings[i],b=c||h._renderFileFooter(m,s,"auto",l),C=h._getPreviewIcon(n),y="type-default",x=C&&h.preferIconicPreview,T=C&&h.preferIconicZoomPreview;return _&&e.each(_,function(e,t){g+=e+":"+t+";"}),f=function(a,l,s,c){var f=s?"zoom-"+o:o,v=h._getPreviewTemplate(a),w=(d||"")+" "+c;return h.frameClass&&(w=h.frameClass+" "+w),s&&(w=w.replace(" "+t.SORT_CSS,"")),v=h._parseFilePreviewIcon(v,n),"text"===a&&(l=t.htmlEncode(l)),"object"!==i||r||e.each(h.defaults.fileTypeSettings,function(e,t){"object"!==e&&"other"!==e&&t(n,r)&&(y="type-"+e)}),v.setTokens({previewId:f,caption:m,frameClass:w,type:r,fileindex:u,typeCss:y,footer:b,data:l,template:p||i,style:g?'style="'+g+'"':""})},u=u||o.slice(o.lastIndexOf("-")+1),h.fileActionSettings.showZoom&&(v=f(T?"other":i,a,!0,"kv-zoom-thumb")),v="\n"+h._getLayoutTemplate("zoomCache").replace("{zoomContent}",v),f(x?"other":i,a,!1,"kv-preview-thumb")+v},_addToPreview:function(e,t){return this.reversePreviewOrder?e.prepend(t):e.append(t)},_previewDefault:function(i,a,n){var r=this,o=r.$preview;if(r.showPreview){var l,s=i?i.name:"",d=i?i.type:"",c=i.size||0,u=r.slug(s),p=!0===n&&!r.isAjaxUpload,f=t.objUrl.createObjectURL(i);r._clearDefaultPreview(),l=r._generatePreviewTemplate("other",f,s,d,a,p,c),r._addToPreview(o,l),r._setThumbAttr(a,u,c),!0===n&&r.isAjaxUpload&&r._setThumbStatus(e("#"+a),"Error")}},_previewFile:function(e,i,a,n,r,o){if(this.showPreview){var l,s=this,d=i?i.name:"",c=o.type,u=o.name,p=s._parseFileType(c,d),f=s.allowedPreviewTypes,h=s.allowedPreviewMimeTypes,m=s.$preview,v=i.size||0,g=f&&f.indexOf(p)>=0,w=h&&-1!==h.indexOf(c),_="text"===p||"html"===p||"image"===p?a.target.result:r;if("html"===p&&s.purifyHtml&&window.DOMPurify&&(_=window.DOMPurify.sanitize(_)),g||w){l=s._generatePreviewTemplate(p,_,d,c,n,!1,v),s._clearDefaultPreview(),s._addToPreview(m,l);var b=m.find("#"+n+" img");b.length&&s.autoOrientImage?t.validateOrientation(i,function(e){if(!e)return void s._validateImage(n,u,c,v,_);var a=m.find("#zoom-"+n+" img"),r="rotate-"+e;e>4&&(r+=b.width()>b.height()?" is-portrait-gt4":" is-landscape-gt4"),t.addCss(b,r),t.addCss(a,r),s._raise("fileimageoriented",{$img:b,file:i}),s._validateImage(n,u,c,v,_),t.adjustOrientedImage(b)}):s._validateImage(n,u,c,v,_)}else s._previewDefault(i,n);s._setThumbAttr(n,u,v),s._initSortable()}},_setThumbAttr:function(t,i,a){var n=this,r=e("#"+t);r.length&&(a=a&&a>0?n._getSize(a):"",r.data({caption:i,size:a}))},_setInitThumbAttr:function(){var e,i,a,n,r=this,o=r.previewCache.data,l=r.previewCache.count();if(0!==l)for(var s=0;l>s;s++)e=o.config[s],n=r.previewInitId+"-init_"+s,i=t.ifSet("caption",e,t.ifSet("filename",e)),a=t.ifSet("size",e),r._setThumbAttr(n,i,a)},_slugDefault:function(e){return t.isEmpty(e)?"":String(e).replace(/[\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_updateFileDetails:function(e){var i=this,a=i.$element,n=i.getFileStack(),r=t.isIE(9)&&t.findFileName(a.val())||a[0].files[0]&&a[0].files[0].name||n.length&&n[0].name||"",o=i.slug(r),l=i.isAjaxUpload?n.length:e,s=i.previewCache.count()+l,d=1===l?o:i._getMsgSelected(s);i.isError?(i.$previewContainer.removeClass("file-thumb-loading"),i.$previewStatus.html(""),i.$captionContainer.removeClass("icon-visible")):i._showFileIcon(),i._setCaption(d,i.isError),i.$container.removeClass("file-input-new file-input-ajax-new"),1===arguments.length&&i._raise("fileselect",[e,o]),i.previewCache.count()&&i._initPreviewActions()},_setThumbStatus:function(e,t){var i=this;if(i.showPreview){var a="indicator"+t,n=a+"Title",r="file-preview-"+t.toLowerCase(),o=e.find(".file-upload-indicator"),l=i.fileActionSettings;e.removeClass("file-preview-success file-preview-error file-preview-loading"),"Success"===t&&e.find(".file-drag-handle").remove(),o.html(l[a]),o.attr("title",l[n]),e.addClass(r),"Error"!==t||i.retryErrorUploads||e.find(".kv-file-upload").attr("disabled",!0)}},_setProgressCancelled:function(){var e=this;e._setProgress(101,e.$progress,e.msgCancelled)},_setProgress:function(e,i,a){var n,r=this,o=Math.min(e,100),l=r.progressUploadThreshold,s=100>=e?r.progressTemplate:r.progressCompleteTemplate,d=100>o?r.progressTemplate:a?r.progressErrorTemplate:s;i=i||r.$progress,t.isEmpty(d)||(n=l&&o>l&&100>=e?d.setTokens({percent:l,status:r.msgUploadThreshold}):d.setTokens({percent:o,status:e>100?r.msgUploadEnd:o+"%"}),i.html(n),a&&i.find('[role="progressbar"]').html(a))},_setFileDropZoneTitle:function(){var e,i=this,a=i.$container.find(".file-drop-zone"),n=i.dropZoneTitle;i.isClickable&&(e=t.isEmpty(i.$element.attr("multiple"))?i.fileSingle:i.filePlural,n+=i.dropZoneClickTitle.replace("{files}",e)),a.find("."+i.dropZoneTitleClass).remove(),i.isAjaxUpload&&i.showPreview&&0!==a.length&&!(i.getFileStack().length>0)&&i.dropZoneEnabled&&(0===a.find(t.FRAMES).length&&t.isEmpty(i.defaultPreviewContent)&&a.prepend('<div class="'+i.dropZoneTitleClass+'">'+n+"</div>"),i.$container.removeClass("file-input-new"),t.addCss(i.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(t,i,a){var n=this,r=0;n._setProgress(i,e("#"+t).find(".file-thumb-progress")),n.uploadStatus[t]=i,e.each(n.uploadStatus,function(e,t){r+=t}),n._setProgress(Math.floor(r/a))},_validateMinCount:function(){var e=this,t=e.isAjaxUpload?e.getFileStack().length:e.$element.get(0).files.length;return!(e.validateInitialCount&&e.minFileCount>0&&e._getFileCount(t-1)<e.minFileCount)||(e._noFilesError({}),!1)},_getFileCount:function(e){var t=this,i=0;return t.validateInitialCount&&!t.overwriteInitial&&(i=t.previewCache.count(),e+=i),e},_getFileId:function(e){var t,i=this,a=i.generateFileId;return"function"==typeof a?a(e,event):e?(t=String(e.webkitRelativePath||e.fileName||e.name||null),t?e.size+"-"+t.replace(/[^0-9a-zA-Z_-]/gim,""):null):null},_getFileName:function(e){return e&&e.name?this.slug(e.name):void 0},_getFileIds:function(e){return this.fileids.filter(function(t){return e?void 0!==t:void 0!==t&&null!==t})},_getFileNames:function(e){return this.filenames.filter(function(t){return e?void 0!==t:void 0!==t&&null!==t})},_setPreviewError:function(e,t,i,a){var n=this;if(void 0!==t&&n.updateStack(t,i),n.showPreview){if(n.removeFromPreviewOnError&&!a)return void e.remove();n._setThumbStatus(e,"Error"),n._refreshUploadButton(e,a)}},_refreshUploadButton:function(e,t){var i=this,a=e.find(".kv-file-upload"),n=i.fileActionSettings,r=n.uploadIcon,o=n.uploadTitle;a.length&&(t&&(r=n.uploadRetryIcon,o=n.uploadRetryTitle),a.attr("title",o).html(r))},_checkDimensions:function(e,i,a,n,r,o,l){var s,d,c,u=this,p="Small"===i?"min":"max",f=u[p+"Image"+o];!t.isEmpty(f)&&a.length&&(c=a[0],d="Width"===o?c.naturalWidth||c.width:c.naturalHeight||c.height,("Small"===i?d>=f:f>=d)||(s=u["msgImage"+o+i].setTokens({name:r,size:f}),u._showUploadError(s,l),u._setPreviewError(n,e,null)))},_validateImage:function(t,i,a,n,r){var o,l,s,d,c=this,u=c.$preview,p=u.find("#"+t),f=p.attr("data-fileindex"),h=p.find("img");i=i||"Untitled",h.one("load",function(){l=p.width(),s=u.width(),l>s&&h.css("width","100%"),o={ind:f,id:t},c._checkDimensions(f,"Small",h,p,i,"Width",o),c._checkDimensions(f,"Small",h,p,i,"Height",o),c.resizeImage||(c._checkDimensions(f,"Large",h,p,i,"Width",o),c._checkDimensions(f,"Large",h,p,i,"Height",o)),c._raise("fileimageloaded",[t]);try{d=window.piexif?window.piexif.load(r):null}catch(e){d=null}c.loadedImages.push({ind:f,img:h,thumb:p,pid:t,typ:a,siz:n,validated:!1,imgData:r,exifObj:d}),p.data("exif",d),c._validateAllImages()}).one("error",function(){c._raise("fileimageloaderror",[t])}).each(function(){this.complete?e(this).trigger("load"):this.error&&e(this).trigger("error")})},_validateAllImages:function(){var e,t,i,a=this,n={val:0},r=a.loadedImages.length,o=a.resizeIfSizeMoreThan;if(r===a.totalImagesCount&&(a._raise("fileimagesloaded"),a.resizeImage))for(e=0;e<a.loadedImages.length;e++)t=a.loadedImages[e],t.validated||(i=t.siz,i&&i>1e3*o&&a._getResizedImage(t,n,r),a.loadedImages[e].validated=!0)},_getResizedImage:function(i,a,n){var r,o,l,s,d,c,u,p=this,f=e(i.img)[0],h=f.naturalWidth,m=f.naturalHeight,v=1,g=p.maxImageWidth||h,w=p.maxImageHeight||m,_=!(!h||!m),b=p.imageCanvas,C=p.imageCanvasContext,y=i.typ,x=i.pid,T=i.ind,E=i.thumb,S=i.exifObj;if(d=function(e,t,i){p.isAjaxUpload?p._showUploadError(e,t,i):p._showError(e,t,i),p._setPreviewError(E,T)},(!p.filestack[T]||!_||g>=h&&w>=m)&&(_&&p.filestack[T]&&p._raise("fileimageresized",[x,T]),a.val++,a.val===n&&p._raise("fileimagesresized"),!_))return void d(p.msgImageResizeError,{id:x,index:T},"fileimageresizeerror");y=y||p.resizeDefaultImageType,o=h>g,l=m>w,v="width"===p.resizePreference?o?g/h:l?w/m:1:l?w/m:o?g/h:1,p._resetCanvas(),h*=v,m*=v,b.width=h,b.height=m;try{C.drawImage(f,0,0,h,m),s=b.toDataURL(y,p.resizeQuality),S&&(u=window.piexif.dump(S),s=window.piexif.insert(u,s)),r=t.dataURI2Blob(s),p.filestack[T]=r,p._raise("fileimageresized",[x,T]),a.val++,a.val===n&&p._raise("fileimagesresized",[void 0,void 0]),r instanceof Blob||d(p.msgImageResizeError,{id:x,index:T},"fileimageresizeerror")}catch(e){a.val++,a.val===n&&p._raise("fileimagesresized",[void 0,void 0]),c=p.msgImageResizeException.replace("{errors}",e.message),d(c,{id:x,index:T},"fileimageresizeexception")}},_initBrowse:function(e){var t=this;t.showBrowse?(t.$btnFile=e.find(".btn-file"),t.$btnFile.append(t.$element)):t.$element.hide()},_initCaption:function(){var e=this,i=e.initialCaption||"";return e.overwriteInitial||t.isEmpty(i)?(e.$caption.val(""),!1):(e._setCaption(i),!0)},_setCaption:function(i,a){var n,r,o,l,s,d=this,c=d.getFileStack();if(d.$caption.length){if(d.$captionContainer.removeClass("icon-visible"),a)n=e("<div>"+d.msgValidationError+"</div>").text(),l=c.length,s=l?1===l&&c[0]?d._getFileNames()[0]:d._getMsgSelected(l):d._getMsgSelected(d.msgNo),r=t.isEmpty(i)?s:i,o='<span class="'+d.msgValidationErrorClass+'">'+d.msgValidationErrorIcon+"</span>";else{if(t.isEmpty(i))return;n=e("<div>"+i+"</div>").text(),r=n,o=d._getLayoutTemplate("fileIcon")}d.$captionContainer.addClass("icon-visible"),d.$caption.attr("title",n).val(r),d.$captionIcon.html(o)}},_createContainer:function(){var t=this,i={class:"file-input file-input-new"+(t.rtl?" kv-rtl":"")},a=e(document.createElement("div")).attr(i).html(t._renderMain());return t.$element.before(a),t._initBrowse(a),t.theme&&a.addClass("theme-"+t.theme),a},_refreshContainer:function(){var e=this,t=e.$container;t.before(e.$element),t.html(e._renderMain()),e._initBrowse(t),e._validateDisabled()},_validateDisabled:function(){var e=this;e.$caption.attr({readonly:e.isDisabled})},_renderMain:function(){var e=this,t=e.isAjaxUpload&&e.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",i=e.showClose?e._getLayoutTemplate("close"):"",a=e.showPreview?e._getLayoutTemplate("preview").setTokens({class:e.previewClass,dropClass:t}):"",n=e.isDisabled?e.captionClass+" file-caption-disabled":e.captionClass,r=e.captionTemplate.setTokens({class:n+" kv-fileinput-caption"});return e.mainTemplate.setTokens({class:e.mainClass+(!e.showBrowse&&e.showCaption?" no-browse":""),preview:a,close:i,caption:r,upload:e._renderButton("upload"),remove:e._renderButton("remove"),cancel:e._renderButton("cancel"),browse:e._renderButton("browse")})},_renderButton:function(e){var i=this,a=i._getLayoutTemplate("btnDefault"),n=i[e+"Class"],r=i[e+"Title"],o=i[e+"Icon"],l=i[e+"Label"],s=i.isDisabled?" disabled":"",d="button";switch(e){case"remove":if(!i.showRemove)return"";break;case"cancel":if(!i.showCancel)return"";n+=" kv-hidden";break;case"upload":if(!i.showUpload)return"";i.isAjaxUpload&&!i.isDisabled?a=i._getLayoutTemplate("btnLink").replace("{href}",i.uploadUrl):d="submit";break;case"browse":if(!i.showBrowse)return"";a=i._getLayoutTemplate("btnBrowse");break;default:return""}return n+="browse"===e?" btn-file":" fileinput-"+e+" fileinput-"+e+"-button",t.isEmpty(l)||(l=' <span class="'+i.buttonLabelClass+'">'+l+"</span>"),a.setTokens({type:d,css:n,title:r,status:s,icon:o,label:l})},_renderThumbProgress:function(){var e=this;return'<div class="file-thumb-progress kv-hidden">'+e.progressTemplate.setTokens({percent:"0",status:e.msgUploadBegin})+"</div>"},_renderFileFooter:function(e,i,a,n){var r,o=this,l=o.fileActionSettings,s=l.showRemove,d=l.showDrag,c=l.showUpload,u=l.showZoom,p=o._getLayoutTemplate("footer"),f=o._getLayoutTemplate("indicator"),h=n?l.indicatorError:l.indicatorNew,m=n?l.indicatorErrorTitle:l.indicatorNewTitle,v=f.setTokens({indicator:h,indicatorTitle:m});return i=o._getSize(i),r=o.isAjaxUpload?p.setTokens({actions:o._renderFileActions(c,!1,s,u,d,!1,!1,!1),caption:e,size:i,width:a,progress:o._renderThumbProgress(),indicator:v}):p.setTokens({actions:o._renderFileActions(!1,!1,!1,u,d,!1,!1,!1),caption:e,size:i,width:a,progress:"",indicator:v}),r=t.replaceTags(r,o.previewThumbTags)},_renderFileActions:function(e,t,i,a,n,r,o,l,s,d,c){if(!(e||t||i||a||n))return"";var u,p=this,f=!1===o?"":' data-url="'+o+'"',h=!1===l?"":' data-key="'+l+'"',m="",v="",g="",w="",_="",b=p._getLayoutTemplate("actions"),C=p.fileActionSettings,y=p.otherActionButtons.setTokens({dataKey:h,key:l}),x=r?C.removeClass+" disabled":C.removeClass;return i&&(m=p._getLayoutTemplate("actionDelete").setTokens({removeClass:x,removeIcon:C.removeIcon,removeTitle:C.removeTitle,dataUrl:f,dataKey:h,key:l})),e&&(v=p._getLayoutTemplate("actionUpload").setTokens({uploadClass:C.uploadClass,uploadIcon:C.uploadIcon,uploadTitle:C.uploadTitle})),t&&(g=p._getLayoutTemplate("actionDownload").setTokens({downloadClass:C.downloadClass,downloadIcon:C.downloadIcon,downloadTitle:C.downloadTitle,downloadUrl:d||p.initialPreviewDownloadUrl}),g=g.setTokens({filename:c,key:l})),a&&(w=p._getLayoutTemplate("actionZoom").setTokens({zoomClass:C.zoomClass,zoomIcon:C.zoomIcon,zoomTitle:C.zoomTitle})),n&&s&&(u="drag-handle-init "+C.dragClass,_=p._getLayoutTemplate("actionDrag").setTokens({dragClass:u,dragTitle:C.dragTitle,dragIcon:C.dragIcon})),b.setTokens({delete:m,upload:v,download:g,zoom:w,drag:_,other:y})},_browse:function(e){var t=this;t._raise("filebrowse"),e&&e.isDefaultPrevented()||(t.isError&&!t.isAjaxUpload&&t.clear(),t.$captionContainer.focus())},_filterDuplicate:function(e,t,i){var a=this,n=a._getFileId(e);n&&i&&i.indexOf(n)>-1||(i||(i=[]),t.push(e),i.push(n))},_change:function(i){var a=this,n=a.$element;if(!a.isAjaxUpload&&t.isEmpty(n.val())&&a.fileInputCleared)return void(a.fileInputCleared=!1);a.fileInputCleared=!1;var r,o,l,s,d=[],c=arguments.length>1,u=a.isAjaxUpload,p=c?i.originalEvent.dataTransfer.files:n.get(0).files,f=a.filestack.length,h=t.isEmpty(n.attr("multiple")),m=h&&f>0,v=0,g=a._getFileIds();if(a.reader=null,a._resetUpload(),a._hideFileIcon(),a.isAjaxUpload&&a.$container.find(".file-drop-zone ."+a.dropZoneTitleClass).remove(),c?e.each(p,function(e,t){t&&!t.type&&void 0!==t.size&&t.size%4096==0?v++:a._filterDuplicate(t,d,g)}):(p=i.target&&void 0===i.target.files?i.target.value?[{name:i.target.value.replace(/^.+\\/,"")}]:[]:i.target.files||{},u?e.each(p,function(e,t){a._filterDuplicate(t,d,g)}):d=p),t.isEmpty(d)||0===d.length)return u||a.clear(),a._showFolderError(v),void a._raise("fileselectnone");if(a._resetErrors(),s=d.length,o=a._getFileCount(a.isAjaxUpload?a.getFileStack().length+s:s),a.maxFileCount>0&&o>a.maxFileCount){if(!a.autoReplace||s>a.maxFileCount)return l=a.autoReplace&&s>a.maxFileCount?s:o,r=a.msgFilesTooMany.replace("{m}",a.maxFileCount).replace("{n}",l),a.isError=function(t,i,n,r){var o=e.extend(!0,{},a._getOutData({},{},p),{id:n,index:r}),l={id:n,index:r,file:i,files:p};return a.isAjaxUpload?a._showUploadError(t,o):a._showError(t,l)}(r,null,null,null),a.$captionContainer.removeClass("icon-visible"),a._setCaption("",!0),void a.$container.removeClass("file-input-new file-input-ajax-new");o>a.maxFileCount&&a._resetPreviewThumbs(u)}else!u||m?(a._resetPreviewThumbs(!1),m&&a.clearStack()):!u||0!==f||a.previewCache.count()&&!a.overwriteInitial||a._resetPreviewThumbs(!0);a.isPreviewable?a.readFiles(d):a._updateFileDetails(1),a._showFolderError(v)},_abort:function(t){var i,a=this;return a.ajaxAborted&&"object"==typeof a.ajaxAborted&&void 0!==a.ajaxAborted.message?(i=e.extend(!0,{},a._getOutData(),t),i.abortData=a.ajaxAborted.data||{},i.abortMessage=a.ajaxAborted.message,a._setProgress(101,a.$progress,a.msgCancelled),a._showUploadError(a.ajaxAborted.message,i,"filecustomerror"),a.cancel(),!0):!!a.ajaxAborted},_resetFileStack:function(){var i=this,a=0,n=[],r=[],o=[];i._getThumbs().each(function(){var l,s=e(this),d=s.attr("data-fileindex"),c=i.filestack[d],u=s.attr("id");"-1"!==d&&-1!==d&&(void 0!==c?(n[a]=c,r[a]=i._getFileName(c),o[a]=i._getFileId(c),s.attr({id:i.previewInitId+"-"+a,"data-fileindex":a}),a++):(l="uploaded-"+t.uniqId(),s.attr({id:l,"data-fileindex":"-1"}),i.$preview.find("#zoom-"+u).attr("id","zoom-"+l)))}),i.filestack=n,i.filenames=r,i.fileids=o},_isFileSelectionValid:function(e){var t=this;return e=e||0,t.required&&!t.getFilesCount()?(t.$errorContainer.html(""),t._showUploadError(t.msgFileRequired),!1):!(t.minFileCount>0&&t._getFileCount(e)<t.minFileCount)||(t._noFilesError({}),!1)},clearStack:function(){var e=this;return e.filestack=[],e.filenames=[],e.fileids=[],e.$element},updateStack:function(e,t){var i=this;return i.filestack[e]=t,i.filenames[e]=i._getFileName(t),i.fileids[e]=t&&i._getFileId(t)||null,i.$element},addToStack:function(e){var t=this;return t.filestack.push(e),t.filenames.push(t._getFileName(e)),t.fileids.push(t._getFileId(e)),t.$element},getFileStack:function(e){return this.filestack.filter(function(t){return e?void 0!==t:void 0!==t&&null!==t})},getFilesCount:function(){var e=this,t=e.isAjaxUpload?e.getFileStack().length:e.$element.get(0).files.length;return e._getFileCount(t)},readFiles:function(i){this.reader=new FileReader;var a,n=this,r=n.$element,o=n.$preview,l=n.reader,s=n.$previewContainer,d=n.$previewStatus,c=n.msgLoading,u=n.msgProgress,p=n.previewInitId,f=i.length,h=n.fileTypeSettings,m=n.filestack.length,v=n.allowedFileTypes,g=v?v.length:0,w=n.allowedFileExtensions,_=t.isEmpty(w)?"":w.join(", "),b=n.maxFilePreviewSize&&parseFloat(n.maxFilePreviewSize),C=o.length&&(!b||isNaN(b)),y=function(t,r,o,l){var s,d=e.extend(!0,{},n._getOutData({},{},i),{id:o,index:l}),c={id:o,index:l,file:r,files:i};n._previewDefault(r,o,!0),n.isAjaxUpload?(n.addToStack(void 0),setTimeout(function(){a(l+1)},100)):f=0,n._initFileActions(),s=e("#"+o),s.find(".kv-file-upload").hide(),n.removeFromPreviewOnError&&s.remove(),n.isError=n.isAjaxUpload?n._showUploadError(t,d):n._showError(t,c),n._updateFileDetails(f)};n.loadedImages=[],n.totalImagesCount=0,e.each(i,function(e,t){var i=n.fileTypeSettings.image;i&&i(t.type)&&n.totalImagesCount++}),a=function(x){if(t.isEmpty(r.attr("multiple"))&&(f=1),x>=f)return n.isAjaxUpload&&n.filestack.length>0?n._raise("filebatchselected",[n.getFileStack()]):n._raise("filebatchselected",[i]),s.removeClass("file-thumb-loading"),void d.html("");var T,E,S,k,F,P,D,I,A,z,$,j,U=m+x,B=p+"-"+U,O=i[x],R=h.text,L=h.image,M=h.html,Z=O.name?n.slug(O.name):"",N=(O.size||0)/1e3,H="",W=t.objUrl.createObjectURL(O),V=0,q="",Y=0,X=function(){var e=u.setTokens({index:x+1,files:f,percent:50,name:Z});setTimeout(function(){d.html(e),n._updateFileDetails(f),a(x+1)},100),n._raise("fileloaded",[O,B,x,l])};if(g>0)for(E=0;g>E;E++)P=v[E],D=n.msgFileTypes[P]||P,q+=0===E?D:", "+D;if(!1===Z)return void a(x+1);if(0===Z.length)return S=n.msgInvalidFileName.replace("{name}",t.htmlEncode(O.name)),void y(S,O,B,x);if(t.isEmpty(w)||(H=new RegExp("\\.("+w.join("|")+")$","i")),T=N.toFixed(2),n.maxFileSize>0&&N>n.maxFileSize)return S=n.msgSizeTooLarge.setTokens({name:Z,size:T,maxSize:n.maxFileSize}),void y(S,O,B,x);if(null!==n.minFileSize&&N<=t.getNum(n.minFileSize))return S=n.msgSizeTooSmall.setTokens({name:Z,size:T,minSize:n.minFileSize}),void y(S,O,B,x);if(!t.isEmpty(v)&&t.isArray(v)){for(E=0;E<v.length;E+=1)k=v[E],I=h[k],V+=I&&"function"==typeof I&&I(O.type,O.name)?1:0;if(0===V)return S=n.msgInvalidFileType.setTokens({name:Z,types:q}),void y(S,O,B,x)}return 0!==V||t.isEmpty(w)||!t.isArray(w)||t.isEmpty(H)||(F=t.compare(Z,H),0!==(V+=t.isEmpty(F)?0:F.length))?n.showPreview?!C&&N>b?(n.addToStack(O),s.addClass("file-thumb-loading"),n._previewDefault(O,B),n._initFileActions(),n._updateFileDetails(f),void a(x+1)):(o.length&&void 0!==FileReader?(A=R(O.type,Z),z=M(O.type,Z),$=L(O.type,Z),d.html(c.replace("{index}",x+1).replace("{files}",f)),s.addClass("file-thumb-loading"),l.onerror=function(e){n._errorHandler(e,Z)},l.onload=function(i){var a,r,o,s,d,c,u=[];if(r={name:Z,type:O.type},e.each(h,function(e,t){"object"!==e&&"other"!==e&&t(O.type,Z)&&Y++}),0===Y){for(o=new Uint8Array(i.target.result),E=0;E<o.length;E++)s=o[E].toString(16),u.push(s);if(a=u.join("").toLowerCase().substring(0,8),c=t.getMimeType(a,"",""),t.isEmpty(c)&&(d=t.arrayBuffer2String(l.result),c=t.isSvg(d)?"image/svg+xml":t.getMimeType(a,d,O.type)),r={name:Z,type:c},A=R(c,""),z=M(c,""),$=L(c,""),(j=A||z)||$)return void function(e){var t=new FileReader;t.onerror=function(e){n._errorHandler(e,Z)},t.onload=function(e){n._previewFile(x,O,e,B,W,r),n._initFileActions(),X()},e?t.readAsText(O,n.textEncoding):t.readAsDataURL(O)}(j)}n._previewFile(x,O,i,B,W,r),n._initFileActions(),X()},l.onprogress=function(e){if(e.lengthComputable){var t=e.loaded/e.total*100,i=Math.ceil(t);S=u.setTokens({index:x+1,files:f,percent:i,name:Z}),setTimeout(function(){d.html(S)},100)}},A||z?l.readAsText(O,n.textEncoding):$?l.readAsDataURL(O):l.readAsArrayBuffer(O)):(n._previewDefault(O,B),setTimeout(function(){a(x+1),n._updateFileDetails(f)},100),n._raise("fileloaded",[O,B,x,l])),
void n.addToStack(O)):(n.isAjaxUpload&&n.addToStack(O),setTimeout(function(){a(x+1),n._updateFileDetails(f)},100),void n._raise("fileloaded",[O,B,x,l])):(S=n.msgInvalidFileExtension.setTokens({name:Z,extensions:_}),void y(S,O,B,x))},a(0),n._updateFileDetails(f,!1)},lock:function(){var e=this;return e._resetErrors(),e.disable(),e.showRemove&&e.$container.find(".fileinput-remove").hide(),e.showCancel&&e.$container.find(".fileinput-cancel").show(),e._raise("filelock",[e.filestack,e._getExtraData()]),e.$element},unlock:function(e){var t=this;return void 0===e&&(e=!0),t.enable(),t.showCancel&&t.$container.find(".fileinput-cancel").hide(),t.showRemove&&t.$container.find(".fileinput-remove").show(),e&&t._resetFileStack(),t._raise("fileunlock",[t.filestack,t._getExtraData()]),t.$element},cancel:function(){var t,i=this,a=i.ajaxRequests,n=a.length;if(n>0)for(t=0;n>t;t+=1)i.cancelling=!0,a[t].abort();return i._setProgressCancelled(),i._getThumbs().each(function(){var t=e(this),a=t.attr("data-fileindex");t.removeClass("file-uploading"),void 0!==i.filestack[a]&&(t.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),t.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled")),i.unlock()}),i.$element},clear:function(){var i,a=this;if(a._raise("fileclear"))return a.$btnUpload.removeAttr("disabled"),a._getThumbs().find("video,audio,img").each(function(){t.cleanMemory(e(this))}),a._resetUpload(),a.clearStack(),a._clearFileInput(),a._resetErrors(!0),a._hasInitialPreview()?(a._showFileIcon(),a._resetPreview(),a._initPreviewActions(),a.$container.removeClass("file-input-new")):(a._getThumbs().each(function(){a._clearObjects(e(this))}),a.isAjaxUpload&&(a.previewCache.data={}),a.$preview.html(""),i=!a.overwriteInitial&&a.initialCaption.length>0?a.initialCaption:"",a.$caption.attr("title","").val(i),t.addCss(a.$container,"file-input-new"),a._validateDefaultPreview()),0===a.$container.find(t.FRAMES).length&&(a._initCaption()||a.$captionContainer.removeClass("icon-visible")),a._hideFileIcon(),a._raise("filecleared"),a.$captionContainer.focus(),a._setFileDropZoneTitle(),a.$element},reset:function(){var e=this;if(e._raise("filereset"))return e._resetPreview(),e.$container.find(".fileinput-filename").text(""),t.addCss(e.$container,"file-input-new"),(e.getFrames().length||e.isAjaxUpload&&e.dropZoneEnabled)&&e.$container.removeClass("file-input-new"),e.clearStack(),e.formdata={},e._setFileDropZoneTitle(),e.$element},disable:function(){var e=this;return e.isDisabled=!0,e._raise("filedisabled"),e.$element.attr("disabled","disabled"),e.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),e.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),t.addCss(e.$container.find(".btn-file"),"disabled"),e._initDragDrop(),e.$element},enable:function(){var e=this;return e.isDisabled=!1,e._raise("fileenabled"),e.$element.removeAttr("disabled"),e.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),e.$container.find(".fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),e.$container.find(".btn-file").removeClass("disabled"),e._initDragDrop(),e.$element},upload:function(){var i,a,n,r=this,o=r.getFileStack().length,l=!e.isEmptyObject(r._getExtraData());if(r.isAjaxUpload&&!r.isDisabled&&r._isFileSelectionValid(o)){if(r._resetUpload(),0===o&&!l)return void r._showUploadError(r.msgUploadEmpty);if(r.$progress.show(),r.uploadCount=0,r.uploadStatus={},r.uploadLog=[],r.lock(),r._setProgress(2),0===o&&l)return void r._uploadExtraOnly();if(n=r.filestack.length,r.hasInitData=!1,!r.uploadAsync)return r._uploadBatch(),r.$element;for(a=r._getOutData(),r._raise("filebatchpreupload",[a]),r.fileBatchCompleted=!1,r.uploadCache={content:[],config:[],tags:[],append:!0},r.uploadAsyncCount=r.getFileStack().length,i=0;n>i;i++)r.uploadCache.content[i]=null,r.uploadCache.config[i]=null,r.uploadCache.tags[i]=null;for(r.$preview.find(".file-preview-initial").removeClass(t.SORT_CSS),r._initSortable(),r.cacheInitialPreview=r.getPreview(),i=0;n>i;i++)r.filestack[i]&&r._uploadSingle(i,!0)}},destroy:function(){var t=this,i=t.$form,a=t.$container,n=t.$element,r=t.namespace;return e(document).off(r),e(window).off(r),i&&i.length&&i.off(r),t.isAjaxUpload&&t._clearFileInput(),t._cleanup(),t._initPreviewCache(),n.insertBefore(a).off(r).removeData(),a.off().remove(),n},refresh:function(i,a){var n=this,r=n.$element;return i="object"!=typeof i||t.isEmpty(i)?n.options:e.extend(!0,{},n.options,i),n._init(i,!0),n._listen(),a&&r.trigger("change"+n.namespace),r},zoom:function(e){var i=this,a=i._getFrame(e),n=i.$modal;a&&(t.initModal(n),n.html(i._getModalContent()),i._setZoomContent(a),n.modal("show"),i._initZoomButtons())},getExif:function(e){var t=this,i=t._getFrame(e);return i&&i.data("exif")||null},getFrames:function(i){var a,n=this;return i=i||"",a=n.$preview.find(t.FRAMES+i),n.reversePreviewOrder&&(a=e(a.get().reverse())),a},getPreview:function(){var e=this;return{content:e.initialPreview,config:e.initialPreviewConfig,tags:e.initialPreviewThumbTags}}},e.fn.fileinput=function(a){if(t.hasFileAPISupport()||t.isIE(9)){var n=Array.apply(null,arguments),r=[];switch(n.shift(),this.each(function(){var o,l=e(this),s=l.data("fileinput"),d="object"==typeof a&&a,c=d.theme||l.data("theme"),u={},p={},f=d.language||l.data("language")||e.fn.fileinput.defaults.language||"en";s||(c&&(p=e.fn.fileinputThemes[c]||{}),"en"===f||t.isEmpty(e.fn.fileinputLocales[f])||(u=e.fn.fileinputLocales[f]||{}),o=e.extend(!0,{},e.fn.fileinput.defaults,p,e.fn.fileinputLocales.en,u,d,l.data()),s=new i(this,o),l.data("fileinput",s)),"string"==typeof a&&r.push(s[a].apply(s,n))}),r.length){case 0:return this;case 1:return r[0];default:return r}}},e.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,browseOnZoneClick:!1,autoReplace:!1,autoOrientImage:!0,required:!1,rtl:!1,hideThumbnailContent:!1,generateFileId:null,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,initialPreviewDownloadUrl:"",removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"></i>',next:'<i class="glyphicon glyphicon-triangle-right"></i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"></i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"></i>',borderless:'<i class="glyphicon glyphicon-resize-full"></i>',close:'<i class="glyphicon glyphicon-remove"></i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-sm btn-kv btn-default btn-outline-secondary",fullscreen:"btn btn-sm btn-kv btn-default btn-outline-secondary",borderless:"btn btn-sm btn-kv btn-default btn-outline-secondary",close:"btn btn-sm btn-kv btn-default btn-outline-secondary"},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedPreviewTypes:void 0,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"></i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"></i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"></i>',removeClass:"btn btn-default btn-secondary",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"></i>',cancelClass:"btn btn-default btn-secondary",uploadIcon:'<i class="glyphicon glyphicon-upload"></i>',uploadClass:"btn btn-default btn-secondary",uploadUrl:null,uploadUrlThumb:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",resizeIfSizeMoreThan:0,minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"></i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressClass:"progress-bar bg-success progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar bg-success progress-bar-success",progressErrorClass:"progress-bar bg-danger progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:t.closeButton("kv-error-close"),slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0,mergeAjaxCallbacks:!1,mergeAjaxDeleteCallbacks:!1,retryErrorUploads:!0,reversePreviewOrder:!1},e.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgPlaceholder:"Select {files}...",msgZoomModalHeading:"Detailed Preview",msgFileRequired:"You must select a file to upload.",msgSizeTooSmall:'File "{name}" (<b>{size} KB</b>) is too small and must be larger than <b>{minSize} KB</b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB</b>) exceeds maximum allowed upload size of <b>{maxSize} KB</b>.',msgFilesTooLess:"You must select at least <b>{n}</b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})</b> exceeds maximum allowed limit of <b>{m}</b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadEmpty:"No valid data available for upload.",msgUploadError:"Error",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}</pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}},e.fn.fileinput.Constructor=i,e(document).ready(function(){var t=e("input.file[type=file]");t.length&&t.fileinput()})});